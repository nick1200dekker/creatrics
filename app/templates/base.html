<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Creatrics - AI-Powered Content Creation Tools{% endblock %}</title>
    
{% block seo_meta %}
<meta name="description" content="Creatrics - Professional AI-powered content creation suite for creators. Generate viral YouTube scripts, engaging social media posts, eye-catching thumbnails, and comprehensive analytics. Boost your content strategy with advanced AI technology.">
<meta name="keywords" content="AI content creation, YouTube content generator, social media AI tools, video script writer, thumbnail generator, content analytics, AI writing assistant, viral content creator, social media scheduler, YouTube optimization">
<meta name="author" content="Creatrics">
<meta name="robots" content="index, follow">
<link rel="canonical" href="{{ request.url }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.url }}">
<meta property="og:title" content="Creatrics - AI-Powered Content Creation Suite">
<meta property="og:description" content="Transform your content creation with AI. Generate viral scripts, engaging posts, stunning thumbnails, and track performance - all in one powerful platform.">
<meta property="og:image" content="{{ url_for('static', filename='images/og-image.png', _external=True) }}">
<meta property="og:site_name" content="Creatrics">
<meta property="og:locale" content="en_US">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ request.url }}">
<meta name="twitter:title" content="Creatrics - AI Content Creation Platform">
<meta name="twitter:description" content="Create viral content with AI. Scripts, thumbnails, posts, analytics - everything creators need in one platform.">
<meta name="twitter:image" content="{{ url_for('static', filename='images/twitter-card.png', _external=True) }}">
<meta name="twitter:creator" content="@creatrics">

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Creatrics",
  "description": "AI-powered content creation platform for YouTube and social media creators",
  "url": "{{ request.url_root }}",
  "applicationCategory": "BusinessApplication",
  "operatingSystem": "Web Browser",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "creator": {
    "@type": "Organization",
    "name": "Creatrics"
  }
}
</script>
{% endblock %}

<!-- Favicon -->
<link rel="icon" href="{{ url_for('static', filename='favicons/favicon.ico') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicons/favicon-16x16.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicons/favicon-32x32.png') }}">
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='favicons/apple-touch-icon.png') }}">
<link rel="manifest" href="{{ url_for('static', filename='favicons/site.webmanifest') }}">
<meta name="theme-color" content="#3B82F6">

<!-- Import Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<!-- Import Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Import Phosphor Icons -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<!-- Import Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>

<script>
    // Immediately apply dark mode to prevent flash
    // Dark mode is default unless explicitly disabled
    const darkModeSetting = localStorage.getItem('darkMode');
    if (darkModeSetting === null || darkModeSetting === 'true') {
        document.documentElement.classList.add('dark');
    }

    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    'brand-blue': '#3B82F6',
                    'brand-purple': '#3B82F6',
                    'brand-pink': '#2563EB',
                    'brand-orange': '#F97316',
                }
            }
        }
    }
</script>

<style>
    :root {
        --brand-gradient: #3B82F6;
        --accent-blue: #3B82F6;
        --sidebar-width: 225px;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

        /* Light mode colors */
        --bg-primary: #F8FAFC;
        --bg-secondary: #FFFFFF;
        --bg-tertiary: #F1F5F9;
        --text-primary: #1E293B;
        --text-secondary: #475569;
        --text-tertiary: #64748B;
        --border-primary: #E2E8F0;
        --border-secondary: rgba(226, 232, 240, 0.8);
        --hover-bg: #F1F5F9;
        --sidebar-bg: #FFFFFF;
        --sidebar-text: #475569;
        --sidebar-hover: #F8FAFC;
    }

    /* Dark mode colors - balanced dark theme */
    html.dark {
        --bg-primary: #18181b;
        --bg-secondary: #27272a;
        --bg-tertiary: #3f3f46;
        --text-primary: #fafafa;
        --text-secondary: #d4d4d8;
        --text-tertiary: #a1a1aa;
        --border-primary: #3f3f46;
        --border-secondary: rgba(63, 63, 70, 0.5);
        --hover-bg: #3f3f46;
        --sidebar-bg: #27272a;
        --sidebar-text: #d4d4d8;
        --sidebar-hover: #3f3f46;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
    }
    
    * {
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        overflow-x: hidden;
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    /* Animated Background - Safe version */
    .animated-bg {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -10;
        background: var(--bg-primary);
        overflow: hidden;
        pointer-events: none;
    }
    
    .animated-bg::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background-image:
            radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.04) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 168, 0.04) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(120, 198, 255, 0.04) 0%, transparent 50%);
        opacity: 0.6;
        pointer-events: none;
    }

    html.dark .animated-bg::before {
        display: none;
    }
    
    .gradient-mesh {
        position: absolute;
        width: 150%;
        height: 150%;
        top: -25%;
        left: -25%;
        background-image:
            radial-gradient(at 20% 30%, rgba(59, 130, 246, 0.06) 0px, transparent 50%),
            radial-gradient(at 80% 20%, rgba(139, 92, 246, 0.06) 0px, transparent 50%),
            radial-gradient(at 40% 80%, rgba(236, 72, 153, 0.06) 0px, transparent 50%);
        animation: mesh-animation 30s ease infinite;
        pointer-events: none;
    }

    html.dark .gradient-mesh {
        display: none;
    }
    
    @keyframes mesh-animation {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        33% { transform: translate(-15px, -15px) rotate(0.5deg); }
        66% { transform: translate(15px, -8px) rotate(-0.5deg); }
    }
    
    /* Sidebar */
    .sidebar {
        width: var(--sidebar-width);
        background: var(--sidebar-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-right: 1px solid var(--border-secondary);
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 40;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.03);
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    html.dark .sidebar {
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.2);
    }
    
    .logo-section {
        padding: 10px;
        margin: 0;
        border-bottom: 1px solid var(--border-primary);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        transition: all 0.3s ease;
    }

    html.dark .logo-section {
        border-bottom-color: rgba(63, 63, 70, 0.8);
    }
    
    .logo-section img {
        height: 44px;
        width: auto;
        display: block;
        object-fit: contain;
        transition: all 0.2s ease;
        filter: drop-shadow(0 1px 3px rgba(59, 130, 246, 0.1));
        position: relative;
        z-index: 2;
    }

    html.dark .logo-section img {
        filter: brightness(0) saturate(100%) invert(100%);
    }

    .logo-section img:hover {
        transform: scale(1.05);
        filter: drop-shadow(0 2px 6px rgba(59, 130, 246, 0.2));
    }

    html.dark .logo-section img:hover {
        filter: brightness(0) saturate(100%) invert(100%);
    }
    
    .nav-section {
        padding: 0.75rem 0.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        min-height: 0;
    }
    
    /* Custom scrollbar for nav section */
    .nav-section::-webkit-scrollbar {
        width: 4px;
    }
    
    .nav-section::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .nav-section::-webkit-scrollbar-thumb {
        background: var(--border-primary);
        border-radius: 2px;
    }
    
    .nav-section::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
    }
    
    .nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0.8rem;
        margin: 0.15rem 0;
        border-radius: 8px;
        color: #64748B;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s ease;
        position: relative;
        text-decoration: none;
        height: 48px;
        cursor: pointer;
        user-select: none;
    }
    
    .nav-item:hover {
        color: var(--text-primary);
        background: var(--hover-bg);
        transform: translateX(2px);
    }
    
    .nav-item:active {
        transform: translateX(1px);
        background: var(--border-primary);
    }
    
    .nav-item.active {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
        color: var(--accent-blue);
        font-weight: 600;
        box-shadow: var(--shadow-sm);
    }

    html.dark .nav-item.active {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(99, 102, 241, 0.2) 100%);
        color: #60A5FA;
    }
    
    .nav-item.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 3px;
        height: 60%;
        background: var(--accent-blue);
        border-radius: 0 2px 2px 0;
    }
    
    .nav-item i {
        font-size: 1.1rem;
        pointer-events: none;
    }

    /* Expandable menu styles */
    .nav-group {
        margin: 0.15rem 0;
    }

    .nav-group-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 0.8rem;
        margin: 0.15rem 0;
        border-radius: 8px;
        color: #64748B;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s ease;
        cursor: pointer;
        user-select: none;
    }

    .nav-group-header:hover {
        background: var(--hover-bg);
    }

    /* Only the icon color changes when expanded */
    /* REMOVED - No color change on expansion
    .nav-group-header.expanded .left-content i {
        color: var(--accent-blue);
    }
    */

    .nav-group-header .left-content span {
        color: #64748B;
        font-weight: 500;
    }

    .nav-group-header:hover .left-content span {
        color: var(--text-primary);
    }

    .nav-group-header .left-content {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .nav-group-header .chevron {
        transition: transform 0.2s ease;
        font-size: 0.875rem;
        color: var(--text-tertiary);
    }

    .nav-group-header.expanded .chevron {
        transform: rotate(90deg);
    }

    .nav-group-items {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
    }

    .nav-group-items.expanded {
        max-height: 500px;
        opacity: 1;
        transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
    }

    .nav-subitem {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.6rem 0.8rem 0.6rem 2.5rem;
        margin: 0.1rem 0;
        border-radius: 8px;
        color: #64748B;
        font-size: 0.825rem;
        font-weight: 500;
        transition: all 0.15s ease;
        position: relative;
        text-decoration: none;
        cursor: pointer;
        user-select: none;
    }

    .nav-subitem:hover {
        color: var(--text-primary);
        background: var(--hover-bg);
        transform: translateX(2px);
    }

    .nav-subitem.active {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
        color: var(--accent-blue);
        font-weight: 600;
    }

    html.dark .nav-subitem.active {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(99, 102, 241, 0.2) 100%);
        color: #60A5FA;
    }
    
    .admin-section {
        padding: 0.5rem 0;
        margin: 0.75rem;
        border-top: 1px solid var(--border-primary);
        border-bottom: 1px solid var(--border-primary);
    }
    
    .user-section {
        padding: 1rem 0.75rem;
        border-top: 1px solid var(--border-primary);
        background: var(--bg-secondary);
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    html.dark .user-section {
        border-top-color: transparent;
    }

    .dark-mode-toggle-btn {
        width: 100%;
        padding: 0.875rem;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        min-height: 44px;
    }

    .dark-mode-toggle-btn i {
        color: var(--text-primary);
        font-size: 1.25rem;
    }

    /* Light mode - show moon icon */
    .dark-mode-toggle-btn .ph-moon {
        display: block;
    }

    .dark-mode-toggle-btn .ph-sun {
        display: none;
    }

    html.dark .dark-mode-toggle-btn {
        border-color: #52525b;
        background: #3f3f46;
        color: #fafafa;
    }

    html.dark .dark-mode-toggle-btn i {
        color: #fafafa;
    }

    /* Dark mode - show sun icon */
    html.dark .dark-mode-toggle-btn .ph-moon {
        display: none;
    }

    html.dark .dark-mode-toggle-btn .ph-sun {
        display: block;
    }

    .dark-mode-toggle-btn:hover {
        background: #e5e7eb;
        color: var(--text-primary);
        border-color: #d1d5db;
    }

    html.dark .dark-mode-toggle-btn:hover {
        background: #52525b;
        border-color: #71717a;
        color: #fafafa;
    }
    
    .user-card {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        border-radius: 12px;
        transition: all 0.2s ease;
        background: var(--bg-tertiary);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-secondary);
    }

    html.dark .user-card {
        border-color: transparent;
        background: var(--bg-tertiary);
    }
    
    .user-card:hover {
        background: var(--bg-primary);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        transform: translateY(-1px);
    }
    
    .guest-card {
        text-align: center;
        padding: 0.5rem;
    }
    
    .guest-avatar-large {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        background: var(--border-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem;
        box-shadow: var(--shadow-sm);
    }
    
    .guest-avatar-large i {
        font-size: 1.75rem;
        color: var(--text-tertiary);
    }
    
    .guest-title {
        font-size: 1rem;
        font-weight: 600;
        color: #64748B;
        margin-bottom: 1rem;
    }
    
    .guest-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .guest-btn {
        padding: 0.6rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s ease;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        cursor: pointer;
    }
    
    .guest-btn-primary {
        background: var(--accent-blue);
        color: white;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
    }
    
    .guest-btn-primary:hover {
        background: #2563EB;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }
    
    .guest-btn-secondary {
        background: var(--bg-secondary);
        color: var(--sidebar-text);
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-sm);
    }
    
    .guest-btn-secondary:hover {
        background: var(--bg-primary);
        border-color: #CBD5E1;
        transform: translateY(-1px);
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: var(--accent-blue);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        color: white;
        box-shadow: var(--shadow-sm);
    }
    
    .user-info {
        flex: 1;
        min-width: 0;
    }
    
    .user-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 2px;
    }
    
    .user-plan {
        font-size: 0.75rem;
        color: #64748B;
    }
    
    /* Buttons */
    .btn-primary {
        padding: 0.6rem 1.2rem;
        background: var(--brand-gradient);
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.15s ease;
        box-shadow: var(--shadow-md);
        text-decoration: none;
        display: inline-block;
        user-select: none;
    }
    
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
    }
    
    .btn-primary:active {
        transform: translateY(0);
    }
    
    .btn-secondary {
        padding: 0.6rem 1.2rem;
        background: var(--bg-secondary);
        color: var(--sidebar-text);
        font-weight: 600;
        font-size: 0.875rem;
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.15s ease;
        box-shadow: var(--shadow-sm);
        text-decoration: none;
        display: inline-block;
        user-select: none;
    }
    
    .btn-secondary:hover {
        background: var(--bg-primary);
        border-color: #CBD5E1;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }
    
    .btn-secondary:active {
        transform: translateY(0);
    }
    
    /* Main Content */
    .main-content {
        margin-left: var(--sidebar-width);
        min-height: 100vh;
        position: relative;
        z-index: 1;
        padding: 0;
    }
    
    .content-wrapper {
        width: 100%;
        margin: 0;
        padding: 1rem;
        transition: padding 0.3s ease;
    }
    
    .content-panel {
        background: var(--bg-tertiary);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-secondary);
        position: relative;
    }

    html.dark .content-panel {
        border-color: transparent;
        background: var(--bg-secondary);
    }
    
    /* Modal - ONLY BASIC STYLES */
    .guest-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 1rem;
    }
    
    .guest-modal.show {
        display: flex;
    }
    
    .guest-modal-content {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 2rem;
        max-width: 420px;
        width: 90%;
        text-align: center;
        box-shadow: var(--shadow-xl);
    }
    
    .guest-modal-icon {
        font-size: 3.5rem;
        color: var(--accent-blue);
        margin-bottom: 1rem;
    }
    
    .guest-modal h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }
    
    .guest-modal p {
        color: #64748B;
        margin-bottom: 2rem;
        line-height: 1.6;
        font-size: 0.95rem;
    }
    
    .guest-modal-buttons {
        display: flex;
        gap: 0.75rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .guest-modal-buttons a,
    .guest-modal-buttons button {
        min-width: 100px;
    }
    
    /* Page transitions */
    .page-content {
        animation: fadeInUp 0.4s ease-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(6px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Loading skeleton */
    .skeleton-plan {
        display: inline-block;
        background: linear-gradient(90deg, rgba(226, 232, 240, 0.5) 25%, rgba(226, 232, 240, 0.8) 50%, rgba(226, 232, 240, 0.5) 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 4px;
        height: 0.75rem;
        width: 60px;
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
    
    /* Toast Notifications - Elegant and Compact */
    .toast {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        padding: 0.75rem 1rem;
        background: var(--bg-secondary);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border: 1px solid var(--border-primary);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        min-width: 200px;
        max-width: 320px;
        transform: translateX(400px);
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 10000;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .toast.show {
        transform: translateX(0);
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .toast.success {
        border-left: 3px solid #10B981;
        background: linear-gradient(to right, rgba(16, 185, 129, 0.1), var(--bg-secondary));
    }
    .toast.error {
        border-left: 3px solid #EF4444;
        background: linear-gradient(to right, rgba(239, 68, 68, 0.1), var(--bg-secondary));
    }
    .toast.info {
        border-left: 3px solid #3B82F6;
        background: linear-gradient(to right, rgba(59, 130, 246, 0.1), var(--bg-secondary));
    }

    .toast i {
        font-size: 1rem;
        flex-shrink: 0;
    }
    .toast.success i { color: #10B981; }
    .toast.error i { color: #EF4444; }
    .toast.info i { color: #3B82F6; }

    .toast span {
        flex: 1;
        line-height: 1.4;
        color: var(--text-primary);
    }

    /* Mobile adjustments */
    @media (max-width: 640px) {
        .toast {
            top: auto;
            bottom: 1rem;
            right: 1rem;
            left: 1rem;
            max-width: calc(100% - 2rem);
        }
    }
    
    /* Mobile */
    @media (max-width: 768px) {
        .content-wrapper {
            padding: 0.5rem;
        }
        
        .content-panel {
            padding: 1rem;
            border-radius: 12px;
        }
        
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .sidebar.open {
            transform: translateX(0);
        }
        
        .main-content {
            margin-left: 0;
        }
    }
    
    </style>
    {% block additional_styles %}{% endblock %}
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="gradient-mesh"></div>
    </div>
    
<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <!-- Logo Section -->
    <div class="logo-section">
        <img src="{{ url_for('static', filename='img/templates/logo.png') }}" alt="Creatrics Logo" class="logo-img">
    </div>

    
    <!-- Navigation -->
    <nav class="nav-section">
        <a href="{{ url_for('home.dashboard') }}"
           class="nav-item {% if request.endpoint == 'home.dashboard' %}active{% endif %}">
            <i class="ph ph-house"></i>
            <span>Home</span>
        </a>

        <!-- YouTube Group - Only show if user has permissions for any YouTube feature -->
        {% set has_youtube_permissions = not workspace_info or workspace_info.is_owner or
           workspace_info.permissions.video_script or
           workspace_info.permissions.video_title or
           workspace_info.permissions.video_tags or
           workspace_info.permissions.video_description or
           workspace_info.permissions.thumbnail or
           workspace_info.permissions.analytics or
           workspace_info.permissions.analyze_video or
           workspace_info.permissions.competitors %}

        {% if has_youtube_permissions %}
        <div class="nav-group">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                <div class="left-content">
                    <i class="ph ph-youtube-logo"></i>
                    <span>YouTube</span>
                </div>
                <i class="ph ph-caret-right chevron"></i>
            </div>
            <div class="nav-group-items">
                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.keyword_research %}
                <a href="{{ url_for('keyword_research.keyword_research') }}"
                   class="nav-subitem {% if request.endpoint and request.endpoint.startswith('keyword_research.') %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-magnifying-glass"></i>
                    <span>Keyword Research</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.analyze_video %}
                <a href="{{ url_for('analyze_video.analyze_video') }}"
                   class="nav-subitem {% if request.endpoint and 'analyze_video' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-video"></i>
                    <span>Analyze Video</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.competitors %}
                <a href="{{ url_for('competitors.competitors') }}"
                   class="nav-subitem {% if request.endpoint and request.endpoint.startswith('competitors.') %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-users-three"></i>
                    <span>Competitors</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.video_script %}
                <a href="{{ url_for('video_script.video_script') }}"
                   class="nav-subitem {% if request.endpoint and 'video_script' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-scroll"></i>
                    <span>Video Script</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.video_title %}
                <a href="{{ url_for('video_title_tags.video_title_tags') }}"
                   class="nav-subitem {% if request.endpoint and 'video_title_tags' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-sparkle"></i>
                    <span>Title & More</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.optimize_video %}
                <a href="{{ url_for('optimize_video.optimize_video') }}"
                   class="nav-subitem {% if request.endpoint and 'optimize_video' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-magic-wand"></i>
                    <span>Optimize Video</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.thumbnail %}
                <a href="{{ url_for('thumbnail.index') }}"
                   class="nav-subitem {% if request.endpoint and 'thumbnail' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-image"></i>
                    <span>Thumbnail</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.analytics %}
                <a href="{{ url_for('analytics.index', platform='youtube') }}"
                   class="nav-subitem {% if request.endpoint and 'analytics' in request.endpoint and (request.args.get('platform') == 'youtube' or (not request.args.get('platform') and current_platform == 'youtube')) %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-chart-line"></i>
                    <span>Analytics</span>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- X Group - Only show if user has permissions for any X feature -->
        {% set has_x_permissions = not workspace_info or workspace_info.is_owner or
           workspace_info.permissions.x_post_editor or
           workspace_info.permissions.analytics or
           workspace_info.permissions.reply_guy or
           workspace_info.permissions.clip_spaces or
           workspace_info.permissions.niche %}

        {% if has_x_permissions %}
        <div class="nav-group" data-group="X">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                <div class="left-content">
                    <i class="ph ph-x-logo"></i>
                </div>
                <i class="ph ph-caret-right chevron"></i>
            </div>
            <div class="nav-group-items">
                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.x_post_editor %}
                <a href="{{ url_for('x_post_editor.x_post_editor') }}"
                   class="nav-subitem {% if request.endpoint and 'x_post_editor' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-pencil-simple"></i>
                    <span>Post Editor</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.reply_guy %}
                <a href="{{ url_for('reply_guy.index') }}"
                   class="nav-subitem {% if request.endpoint and 'reply_guy' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-chat-circle-text"></i>
                    <span>Reply Guy</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.clip_spaces %}
                <a href="{{ url_for('clip_spaces.index') }}"
                   class="nav-subitem {% if request.endpoint and 'clip_spaces' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-scissors"></i>
                    <span>Clip Spaces</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.niche %}
                <a href="{{ url_for('niche.index') }}"
                   class="nav-subitem {% if request.endpoint and 'niche' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-compass"></i>
                    <span>Niche Radar</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.analytics %}
                <a href="{{ url_for('analytics.index', platform='x') }}"
                   class="nav-subitem {% if request.endpoint and 'analytics' in request.endpoint and (request.args.get('platform') == 'x' or (not request.args.get('platform') and current_platform == 'x')) %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-chart-bar"></i>
                    <span>Analytics</span>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- TikTok Group - Only show if user has permissions for any TikTok feature -->
        {% set has_tiktok_permissions = not workspace_info or workspace_info.is_owner or
           workspace_info.permissions.trend_finder or
           workspace_info.permissions.tiktok_keyword_research or
           workspace_info.permissions.tiktok_competitors or
           workspace_info.permissions.hook_generator or
           workspace_info.permissions.titles_hashtags or
           workspace_info.permissions.tiktok_analytics %}

        {% if has_tiktok_permissions %}
        <div class="nav-group" data-group="TikTok">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                <div class="left-content">
                    <i class="ph ph-tiktok-logo"></i>
                    <span>TikTok</span>
                </div>
                <i class="ph ph-caret-right chevron"></i>
            </div>
            <div class="nav-group-items">
                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.trend_finder %}
                <a href="{{ url_for('trend_finder.trend_finder') }}"
                   class="nav-subitem {% if request.endpoint and 'trend_finder.' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-trend-up"></i>
                    <span>Trend Finder</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.tiktok_keyword_research %}
                <a href="{{ url_for('tiktok_keyword_research.tiktok_keyword_research') }}"
                   class="nav-subitem {% if request.endpoint and request.endpoint.startswith('tiktok_keyword_research.') %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-magnifying-glass"></i>
                    <span>Keyword Research</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.tiktok_competitors %}
                <a href="{{ url_for('tiktok_competitors.tiktok_competitors') }}"
                   class="nav-subitem {% if request.endpoint and 'tiktok_competitors.' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-users-three"></i>
                    <span>Competitors</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.hook_generator %}
                <a href="{{ url_for('hook_generator.hook_generator') }}"
                   class="nav-subitem {% if request.endpoint and 'hook_generator.' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-fish-simple"></i>
                    <span>Hook Generator</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.titles_hashtags %}
                <a href="{{ url_for('titles_hashtags.titles_hashtags') }}"
                   class="nav-subitem {% if request.endpoint and 'titles_hashtags.' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-hash"></i>
                    <span>Titles & Hashtags</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.analytics %}
                <a href="{{ url_for('analytics.index', platform='tiktok') }}"
                   class="nav-subitem {% if request.endpoint and 'analytics' in request.endpoint and (request.args.get('platform') == 'tiktok' or (not request.args.get('platform') and current_platform == 'tiktok')) %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-chart-line"></i>
                    <span>Analytics</span>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Content Hub Group - Only show if user has permissions for any content feature -->
        {% set has_content_permissions = not workspace_info or workspace_info.is_owner or
           workspace_info.permissions.brain_dump or
           workspace_info.permissions.mind_map or
           workspace_info.permissions.content_wiki or
           workspace_info.permissions.content_calendar %}

        {% if has_content_permissions %}
        <div class="nav-group" data-group="Content Hub">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                <div class="left-content">
                    <i class="ph ph-folder-open"></i>
                    <span>Content Hub</span>
                </div>
                <i class="ph ph-caret-right chevron"></i>
            </div>
            <div class="nav-group-items">
                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.brain_dump %}
                <a href="{{ url_for('brain_dump.brain_dump') }}"
                   class="nav-subitem {% if request.endpoint and 'brain_dump' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-brain"></i>
                    <span>Brain Dump</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.mind_map %}
                <a href="{{ url_for('mind_map.mind_map') }}"
                   class="nav-subitem {% if request.endpoint and 'mind_map' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-graph"></i>
                    <span>Mind Map</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.content_wiki %}
                <a href="{{ url_for('content_wiki.content_wiki') }}"
                   class="nav-subitem {% if request.endpoint and 'content_wiki' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-books"></i>
                    <span>Content Wiki</span>
                </a>
                {% endif %}

                {% if not workspace_info or workspace_info.is_owner or workspace_info.permissions.content_calendar %}
                <a href="{{ url_for('content_calendar.content_calendar') }}"
                   class="nav-subitem {% if request.endpoint and 'content_calendar' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-calendar"></i>
                    <span>Content Calendar</span>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Settings Group -->
        <div class="nav-group" data-group="Settings">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                <div class="left-content">
                    <i class="ph ph-gear"></i>
                    <span>Settings</span>
                </div>
                <i class="ph ph-caret-right chevron"></i>
            </div>
            <div class="nav-group-items">
                <a href="{{ url_for('accounts.index') }}"
                   class="nav-subitem {% if request.endpoint and 'accounts' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-user-circle"></i>
                    <span>Social Accounts</span>
                </a>
                {% if can_access_teams %}
                <a href="{{ url_for('teams.teams_dashboard') }}"
                   class="nav-subitem {% if request.endpoint and 'teams' in request.endpoint %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-users-three"></i>
                    <span>Teams</span>
                </a>
                {% endif %}
                {% if not workspace_info or workspace_info.is_owner %}
                <a href="{{ url_for('payment.index') }}"
                   class="nav-subitem {% if request.endpoint == 'payment.index' %}active{% endif %}"
                   onclick="return BaseApp.checkGuestAccess(event, this)">
                    <i class="ph ph-crown"></i>
                    <span>Upgrade</span>
                </a>
                {% endif %}
            </div>
        </div>
    </nav>
    
    <!-- Admin Section -->
    <div class="admin-section" id="admin-section" style="display: none;">
        <!-- Admin features can be added here -->
    </div>
    
    <!-- User Section -->
    <div class="user-section" id="user-section">
        <!-- Workspace Indicator (if in team workspace) -->
        {% if workspace_info and not workspace_info.is_owner %}
        <div style="padding: 0.75rem 1rem; margin-bottom: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-primary); text-align: center;">
            <div style="font-size: 0.9rem; color: var(--text-primary); font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <i class="ph ph-users-three" style="font-size: 1rem; color: #3B82F6;"></i>
                <span>Team Workspace</span>
            </div>
            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">{{ workspace_info.owner_email | default('') }}</div>
        </div>
        {% endif %}

        {% if g.user and not g.user.get('is_guest') %}
        <button id="dark-mode-toggle" class="dark-mode-toggle-btn" title="Toggle Dark Mode">
            <i class="ph ph-moon"></i>
            <i class="ph ph-sun"></i>
        </button>
        <div class="user-card">
            <div class="user-avatar">
                {{ g.user.get('data', {}).get('username', 'User')[0].upper() }}
            </div>
            <div class="user-info">
                <div class="user-name">
                    {{ g.user.get('data', {}).get('username', 'User') }}
                </div>
                <div class="user-plan" id="user-plan-display">
                    <span class="skeleton-plan"></span>
                </div>
            </div>
            <button id="logout-button" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 transition-colors p-1" title="Logout">
                <i class="ph ph-sign-out text-lg"></i>
            </button>
        </div>
        {% else %}
        <div class="guest-card">
            <div class="guest-avatar-large">
                <i class="ph ph-user"></i>
            </div>
            <div class="guest-title">Guest</div>
            <div class="guest-buttons">
                <a href="/auth/login" class="guest-btn guest-btn-primary">
                    <i class="ph ph-sign-in"></i>
                    Login
                </a>
                <a href="/auth/register" class="guest-btn guest-btn-secondary">
                    <i class="ph ph-user-plus"></i>
                    Register
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</aside>
<script>
// Restore nav states synchronously right after sidebar is parsed to prevent flash
window.restoreNavStates = function() {
    document.querySelectorAll('.nav-group').forEach(group => {
        const header = group.querySelector('.nav-group-header');
        const items = group.querySelector('.nav-group-items');
        
        // Get group name from data-group attribute or span text
        let name = group.getAttribute('data-group');
        if (!name) {
            const span = header.querySelector('span');
            name = span ? span.textContent.trim() : 'unknown';
        }
        
        const savedState = localStorage.getItem('nav-' + name);
        const hasActiveItem = group.querySelector('.nav-subitem.active') !== null;

        let shouldExpand = false;
        if (savedState !== null) {
            shouldExpand = savedState === 'expanded';
        } else if (hasActiveItem) {
            shouldExpand = true;
            localStorage.setItem('nav-' + name, 'expanded');
        }

        if (shouldExpand) {
            header.classList.add('expanded');
            items.classList.add('expanded');
        } else {
            header.classList.remove('expanded');
            items.classList.remove('expanded');
        }
    });
};
restoreNavStates();
</script>

<!-- Main Content -->
<main class="main-content">
    <div class="content-wrapper">
        <div class="content-panel">
            <div class="page-content">
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
</main>

<!-- Mobile Menu Toggle -->
<button id="mobile-menu-toggle" class="fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md md:hidden">
    <i class="ph ph-list text-xl"></i>
</button>

<!-- Guest Access Modal -->
<div id="guest-modal" class="guest-modal">
    <div class="guest-modal-content">
        <i class="ph ph-lock guest-modal-icon"></i>
        <h3 id="guest-modal-title">Login Required</h3>
        <p id="guest-modal-message">Register to unlock all features! As a registered user, you'll get access to advanced analytics, player stats, team insights, and more!</p>
        <div class="guest-modal-buttons">
            <a href="/auth/login" class="btn-primary">Login</a>
            <a href="/auth/register" class="btn-secondary">Register</a>
            <button onclick="BaseApp.closeGuestModal()" class="btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<!-- SIMPLE BASE SCRIPTS -->
<script>
    // Simple toggle that keeps state in localStorage permanently
    window.toggleNavGroup = function(header) {
        const items = header.nextElementSibling;
        const group = header.parentElement;
        
        // Get group name from data-group attribute or span text
        let name = group.getAttribute('data-group');
        if (!name) {
            const span = header.querySelector('span');
            name = span ? span.textContent.trim() : 'unknown';
        }
        
        if (header.classList.contains('expanded')) {
            header.classList.remove('expanded');
            items.classList.remove('expanded');
            localStorage.setItem('nav-' + name, 'collapsed');
        } else {
            header.classList.add('expanded');
            items.classList.add('expanded');
            localStorage.setItem('nav-' + name, 'expanded');
        }
    };
    
    // NAMESPACE ALL BASE FUNCTIONALITY
    window.BaseApp = (function() {
        const isGuest = JSON.parse('{{ (not g.user or g.user.get("is_guest")) | tojson }}');
        const isDashboard = JSON.parse('{{ (request.endpoint == "home.dashboard") | tojson }}');
        
        return {
            isGuest: isGuest,
            isDashboard: isDashboard,
            
            checkGuestAccess: function(event, element) {
                if (isGuest) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    document.getElementById('guest-modal-title').textContent = 'Login Required';
                    document.getElementById('guest-modal-message').textContent = 'Register to unlock all features! As a registered user, you\'ll get access to advanced analytics, player stats, team insights, and more!';
                    this.showGuestModal();
                    return false;
                }
                return true;
            },
            
            showGuestModal: function(title, message) {
                const modal = document.getElementById('guest-modal');
                
                if (title) {
                    document.getElementById('guest-modal-title').textContent = title;
                }
                if (message) {
                    document.getElementById('guest-modal-message').textContent = message;
                }
                
                modal.classList.add('show');
            },
            
            closeGuestModal: function() {
                const modal = document.getElementById('guest-modal');
                modal.classList.remove('show');
                
                setTimeout(() => {
                    document.getElementById('guest-modal-title').textContent = 'Login Required';
                    document.getElementById('guest-modal-message').textContent = 'Register to unlock all features! As a registered user, you\'ll get access to advanced analytics, player stats, team insights, and more!';
                }, 300);
            },
            
            showToast: function(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icon = type === 'success' ? 'ph-check-circle' : 
                            type === 'error' ? 'ph-x-circle' : 
                            'ph-info';
                
                toast.innerHTML = `
                    <i class="ph ${icon}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },
            
            init: function() {
                this.initDarkMode();
                this.initLogout();
                this.initMobileMenu();
                this.initModal();
                this.loadUserData();
                // Nav groups are already restored synchronously earlier
            },
            
            initDarkMode: function() {
                // Check for saved dark mode preference or default to dark mode
                const darkModeSetting = localStorage.getItem('darkMode');
                const darkMode = darkModeSetting === null || darkModeSetting === 'true';

                if (darkMode) {
                    document.documentElement.classList.add('dark');
                }

                // Toggle button functionality
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                if (darkModeToggle) {
                    darkModeToggle.addEventListener('click', () => {
                        const isDark = document.documentElement.classList.toggle('dark');
                        localStorage.setItem('darkMode', isDark);
                    });
                }
            },

            initLogout: function() {
                const logoutButton = document.getElementById('logout-button');
                if (logoutButton) {
                    logoutButton.addEventListener('click', async (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        try {
                            const response = await fetch('/auth/logout', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                            });
                            
                            if (response.ok) {
                                this.showToast('Logged out successfully', 'success');
                                setTimeout(() => window.location.href = '/', 1000);
                            }
                        } catch (error) {
                            this.showToast('Logout failed', 'error');
                        }
                    });
                }
            },
            
            initMobileMenu: function() {
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const sidebar = document.getElementById('sidebar');
                
                if (mobileMenuToggle && sidebar) {
                    mobileMenuToggle.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        sidebar.classList.toggle('open');
                        const icon = mobileMenuToggle.querySelector('i');
                        icon.className = sidebar.classList.contains('open') 
                            ? 'ph ph-x text-xl' 
                            : 'ph ph-list text-xl';
                    });
                    
                    document.addEventListener('click', (e) => {
                        if (!sidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                            sidebar.classList.remove('open');
                            const icon = mobileMenuToggle.querySelector('i');
                            icon.className = 'ph ph-list text-xl';
                        }
                    });
                }
            },
            
            initModal: function() {
                const modal = document.getElementById('guest-modal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeGuestModal();
                        }
                    });
                }
            },
            
            loadUserData: async function() {
                if (isGuest) return;
                
                try {
                    const response = await fetch('/api/dashboard-stats', {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        
                        const planDisplay = document.getElementById('user-plan-display');
                        if (planDisplay) {
                            const plan = userData.subscription_plan || 'Free Plan';
                            planDisplay.textContent = plan;
                        }
                        
                        const adminSection = document.getElementById('admin-section');
                        if (adminSection) {
                            const normalizedPlan = (userData.subscription_plan || 'Free Plan').toLowerCase().trim();
                            const isAdminPlan = normalizedPlan === 'admin' || 
                                              normalizedPlan === 'admin plan' ||
                                              normalizedPlan === 'administrator';
                            
                            adminSection.style.display = isAdminPlan ? 'block' : 'none';
                        }
                    }
                } catch (error) {
                    console.warn('Error loading user data:', error);
                }
            }
        };
    })();
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        BaseApp.init();
    });
    
    // Legacy global functions for backward compatibility
    window.checkGuestAccess = function(event, element) {
        return BaseApp.checkGuestAccess(event, element);
    };
    
    window.showGuestModal = function(title, message) {
        return BaseApp.showGuestModal(title, message);
    };
    
    window.closeGuestModal = function() {
        return BaseApp.closeGuestModal();
    };
    
    window.showToast = function(message, type) {
        return BaseApp.showToast(message, type);
    };
    
    window.isGuest = BaseApp.isGuest;
</script>

<!-- Welcome Modal Container - At body level for absolute fixed positioning -->
<div id="welcomeModalContainer"></div>

{% block scripts %}{% endblock %}</body>
</html>