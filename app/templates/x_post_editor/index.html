{% extends "base.html" %}

{% block title %}Post Studio - Create Engaging X/Twitter Content | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Create engaging social media posts with AI. Generate viral X/Twitter content, optimize for engagement, and manage your social media strategy with Creatrics AI-powered post editor.">
<meta name="keywords" content="AI social media editor, Twitter post generator, X content creator, social media AI, viral post creator">
{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/x_post_editor.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/repost-modal.css') }}">
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="post-editor-wrapper">
    <!-- Left Sidebar -->
    <aside class="drafts-sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">
                <i class="ph ph-pencil-simple"></i>
                Post Studio
            </h2>
            <button class="new-draft-btn" id="new-draft-button">
                <i class="ph ph-plus"></i>
                New Draft
            </button>
        </div>
        
        <div class="search-box">
            <div class="search-wrapper">
                <input type="text" 
                       class="search-input" 
                       id="searchInput" 
                       placeholder="Search drafts...">
                <i class="ph ph-magnifying-glass search-icon"></i>
            </div>
        </div>
        
        <div class="drafts-list" id="draftsList">
            <div class="drafts-loading">
                <div class="drafts-loading-spinner">
                    <i class="ph ph-spinner"></i>
                </div>
                <div>Loading drafts...</div>
            </div>
        </div>
        
        <!-- Load More Button -->
        <div class="load-more-container" id="loadMoreContainer" style="display: none;">
            <button class="load-more-btn" id="loadMoreBtn">
                <i class="ph ph-arrow-down"></i>
                <span class="load-more-text">Load More</span>
                <div class="load-more-spinner" style="display: none;">
                    <div class="spinner"></div>
                </div>
            </button>
        </div>
    </aside>
    
    <!-- Right Side - Editor Area (shown by default) -->
    <main class="editor-area" id="editorArea">
        <!-- Editor Header with Toolbar -->
        <div class="editor-header">
            <div class="editor-toolbar">
                <!-- Voice Tone Section -->
                <div class="voice-tone-section">
                    <label class="voice-tone-label">
                        <i class="ph ph-microphone"></i>
                        Voice Tone:
                    </label>
                    <div class="voice-tone-dropdown">
                        <div class="dropdown-trigger" id="voice-tone-trigger">
                            <span id="selected-voice-tone">Creatrics</span>
                            <i class="ph ph-caret-down dropdown-arrow"></i>
                        </div>
                        <div class="dropdown-menu" id="voice-tone-menu">
                            <!-- Options will be dynamically populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Enhancement Mode Section -->
                <div class="enhancement-section">
                    <div class="enhancement-categories">
                        <button class="category-btn active" data-category="create">
                            <i class="ph ph-plus-circle"></i>
                            Create
                        </button>
                        <button class="category-btn" data-category="improve">
                            <i class="ph ph-sparkle"></i>
                            Improve
                        </button>
                        <button class="category-btn" data-category="correct">
                            <i class="ph ph-check-circle"></i>
                            Correct
                        </button>
                    </div>
                    <div class="enhancement-options">
                        <!-- Create Options -->
                        <div class="options-container active" data-category="create">
                            <button class="option-btn active" data-preset="keyword">
                                <i class="ph ph-key"></i>
                                <span>Keyword</span>
                            </button>
                            <button class="option-btn" data-preset="raw_text">
                                <i class="ph ph-text-align-left"></i>
                                <span>Raw Text</span>
                            </button>
                        </div>
                        <!-- Improve Options -->
                        <div class="options-container" data-category="improve">
                            <button class="option-btn" data-preset="hook_story_punch">
                                <i class="ph ph-lightning"></i>
                                <span>Hook</span>
                            </button>
                            <button class="option-btn" data-preset="storytelling">
                                <i class="ph ph-book-open"></i>
                                <span>Storytelling</span>
                            </button>
                            <button class="option-btn" data-preset="mimic" id="mimic-btn" style="display: none;">
                                <i class="ph ph-quotes"></i>
                                <span>Mimic</span>
                            </button>
                        </div>
                        <!-- Correct Options -->
                        <div class="options-container" data-category="correct">
                            <button class="option-btn" data-preset="grammar">
                                <i class="ph ph-text-aa"></i>
                                <span>Grammar</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Execute Section -->
                <div class="execute-section">
                    <label class="section-label">
                        <i class="ph ph-play"></i>
                        Execute:
                    </label>
                    <div class="action-tools">
                        <button id="context-button" class="ai-tool" title="Add Prompt">
                            <i class="ph ph-info"></i>
                            <span class="ai-tool-tooltip">Add Prompt</span>
                        </button>
                        <button id="generate-button" class="btn btn-primary">
                            <i class="ph ph-magic-wand button-icon"></i>
                            <i class="ph ph-spinner button-spinner" style="display: none;"></i>
                            <span class="button-text">Enhance</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Status (top left, only visible when saving) -->
        <div class="save-status-toast" id="saveStatus" style="display: none;">
            <i class="ph ph-spinner"></i>
            <span>Saving...</span>
        </div>

        <!-- Editor Content -->
        <div class="editor-content">
            <div class="posts-container" id="postsContainer">
                <!-- Dynamic posts will appear here -->
            </div>

            <!-- Schedule Card (inline, hidden by default) -->
            <div class="upload-option-card" id="scheduleCard" style="display: none;">
                <div class="schedule-header">
                    <label class="upload-option-label">
                        <i class="ph ph-calendar"></i>
                        Publish Date & Time <span class="utc-indicator" id="timezoneIndicator">(Local Time)</span>
                    </label>
                    <button class="schedule-close-btn" id="scheduleCloseBtn">
                        <i class="ph ph-x"></i>
                    </button>
                </div>
                <div class="schedule-datetime-grid">
                    <select id="scheduleDateSelect" class="schedule-select">
                        <option value="">Select date</option>
                    </select>
                    <select id="scheduleTimeSelect" class="schedule-select">
                        <option value="">Select time</option>
                    </select>
                </div>
                <button id="confirmScheduleBtn" class="schedule-confirm-btn">
                    <i class="ph ph-calendar-check"></i>
                    Schedule Post
                </button>
            </div>
        </div>

        <!-- Editor Footer -->
        <div class="editor-footer-section">
            <!-- Compact Connected Status (shown for premium users) -->
            <div id="compactConnectionStatus" class="compact-connection-status">
                <div class="compact-status-content">
                    <div class="status-dot loading"></div>
                    <span class="compact-status-text">Checking connection...</span>
                </div>
                <button id="compactDisconnectBtn" class="compact-disconnect-btn" style="display: none;">
                    <i class="ph ph-plug"></i>
                    Disconnect
                </button>
            </div>
        </div>

        <!-- X Connection Status (only shown for free users with premium notice) -->
        <div class="connection-card" style="display: none;">
            <div class="connection-header">
                <div class="connection-status">
                    <div class="status-indicator">
                        <div class="status-dot loading"></div>
                        <span class="status-text">Checking connection...</span>
                    </div>

                    <div id="connectionButtons" style="display: none;">
                        <button id="connectXBtn" class="secondary-button" style="display: none;">
                            <i class="ph ph-link"></i>
                            <span>Connect X Account</span>
                        </button>

                        <button id="disconnectXBtn" class="btn-disconnect" style="display: none;">
                            <i class="ph ph-plug"></i>
                            Disconnect
                        </button>
                    </div>

                    <!-- Loading skeleton for buttons -->
                    <div id="buttonSkeleton" class="skeleton-loader" style="width: 150px; height: 36px; border-radius: 8px;"></div>
                </div>

                <!-- User Info (shown when connected) -->
                <div id="userInfo" class="user-info" style="display:none;">
                    <img id="userAvatar" src="/static/img/default-avatar.png" alt="User Avatar" class="user-avatar">
                    <div class="user-details">
                        <div class="user-name" id="userName">X User</div>
                        <div class="user-id" id="userOpenId">@username</div>
                    </div>
                </div>
            </div>

            <!-- Premium Required Notice -->
            <div id="premiumNotice" class="premium-notice" style="display: none;">
                <div class="premium-icon">ðŸ‘‘</div>
                <div class="premium-text">
                    <strong>Premium Feature</strong>
                    <p>X scheduling requires a Premium Creator subscription to connect and schedule posts.</p>
                </div>
                <a href="/payment/checkout" class="premium-upgrade-btn">
                    <i class="ph ph-crown"></i>
                    Upgrade to Premium
                </a>
            </div>
        </div>
    </main>
    </div>
</div>

<!-- AI Enhancement Context Modal -->
<div class="ai-modal" id="context-modal" style="display: none;">
    <div class="ai-modal-content">
        <div class="ai-modal-header">
            <div class="ai-modal-title">
                <i class="ph ph-info"></i>
                Add Prompt
            </div>
            <button class="ai-modal-close" id="context-modal-close">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="ai-modal-body">
            <div class="ai-option-group">
                <label for="context-textarea" class="ai-option-label">
                    <div class="ai-option-icon">
                        <i class="ph ph-text-t"></i>
                    </div>
                    Additional Instructions
                </label>
                <textarea id="context-textarea" class="form-textarea" placeholder="Add prompts like tone, audience, or specific goals for your content..."></textarea>
            </div>
        </div>
        <div class="ai-modal-footer">
            <button class="btn btn-secondary" id="context-cancel-button">Cancel</button>
            <button class="btn btn-primary" id="context-save-button">
                <i class="ph ph-check"></i>
                Apply
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Pass user data to JavaScript
window.userXAccount = '{{ user.x_account | default("", true) }}';
window.hasPremium = {{ 'true' if has_premium else 'false' }};
</script>
<script src="{{ url_for('static', filename='scripts/repost-modal.js') }}"></script>
<script src="{{ url_for('static', filename='scripts/x_post_editor.js') }}"></script>
{% endblock %}
