{% extends "base.html" %}
{% set check_auth = true %}

{% block title %}Reply Guy - AI Twitter Engagement Tool | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Automate your Twitter engagement with AI-powered reply suggestions. Find relevant conversations and generate contextual replies to boost your social media presence.">
<meta name="keywords" content="AI Twitter replies, social media automation, Twitter engagement, automated responses">
{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reply_guy.css') }}">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/reply_guy.js') }}"></script>
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="reply-guy-wrapper">
        <!-- Header -->
        <div class="reply-guy-header">
            <h1 class="reply-guy-title">
                <i class="ph ph-chat-centered-text"></i>
                Reply Guy
            </h1>
            <div class="header-actions">
                <!-- View toggle removed - simplified interface -->
            </div>
        </div>

        <!-- Content Area -->
        <div class="reply-guy-content">
            <!-- Daily Progress Card -->
            <div class="progress-card">
                <div class="progress-header">
                    <div class="progress-title">
                        <i class="ph ph-chart-line-up"></i>
                        Daily Progress
                    </div>
                    <div class="progress-stats">
                        Today's Goal: <span id="progress-target">50</span> replies
                    </div>
                </div>
                <div class="progress-content">
                    <div class="progress-details">
                        <div class="progress-text">
                            Loading progress...
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="progress-numbers">
                        <div class="progress-percentage">0%</div>
                        <div class="progress-label">Complete</div>
                    </div>
                </div>
            </div>

            <!-- Replies Panel -->
            <div id="replies-panel" class="replies-panel">
                <div class="main-panel">
                    <div class="panel-header">
                        <div class="panel-title-section">
                            <h3 class="panel-title">
                                <i class="ph ph-chat-dots"></i>
                                Reply Opportunities
                            </h3>
                            <div class="info-icon">
                                <i class="ph ph-info"></i>
                                <div class="tooltip">
                                    Default lists update automatically.<br>Custom lists require manual update.
                                </div>
                            </div>
                        </div>
                        
                        <div class="panel-controls">
                            <!-- Update button - only visible for custom lists -->
                            <div id="update-button-container" class="update-btn-wrapper" style="display: none;">
                                <button id="update-btn" class="primary-btn" disabled>
                                    <i class="ph ph-arrows-clockwise"></i>
                                    Update
                                </button>
                            </div>

                            <!-- Hidden default list options for JavaScript -->
                            <div style="display: none;">
                                {% if default_lists %}
                                    {% for list in default_lists %}
                                    <div class="dropdown-option" data-value="{{ list.id }}" data-type="default">
                                        {{ list.name }}
                                    </div>
                                    {% endfor %}
                                {% endif %}
                            </div>

                            <!-- Dropdown - only visible for custom lists -->
                            <div class="dropdown compact-dropdown custom-list-dropdown" style="display: none;">
                                <div class="dropdown-trigger" id="list-dropdown-trigger">
                                    <span id="selected-list-text">Choose a list...</span>
                                    <i class="ph ph-caret-down dropdown-arrow"></i>
                                </div>
                                <div class="dropdown-menu compact-menu" id="list-dropdown-menu">
                                    {% if custom_lists %}
                                        {% for list in custom_lists %}
                                        <div class="dropdown-option" data-value="{{ list.id }}" data-type="custom">
                                            <i class="ph ph-user-circle option-icon"></i>
                                            {{ list.name }}
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="dropdown-empty">No custom lists yet</div>
                                    {% endif %}
                                    <div class="dropdown-divider"></div>
                                    <div class="dropdown-option create-new" id="create-new-list">
                                        <i class="ph ph-plus-circle"></i>
                                        <span>Add New X List</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Loading indicator for mode switching -->
                            <div id="mode-switch-loading" class="mode-switch-loading" style="display: none;">
                                <i class="ph ph-spinner spin"></i>
                                <span>Loading list...</span>
                            </div>

                            <!-- Mode Tabs - Always visible on the right -->
                            <div class="mode-tabs-compact">
                                <button class="mode-tab-compact active" data-mode="default">
                                    <i class="ph ph-sparkle"></i>
                                    <span>Default</span>
                                </button>
                                <button class="mode-tab-compact" data-mode="custom">
                                    <i class="ph ph-user-circle"></i>
                                    <span>Custom</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="panel-content" id="tweets-container">
                        <!-- Loading Section -->
                        <div class="loading-section" id="tweets-loading-section" style="display: flex;">
                            <div class="loading-card">
                                <div class="loading-icon">
                                    <i class="ph ph-spinner spin"></i>
                                </div>
                                <h2 class="loading-title">Loading Reply Opportunities</h2>
                                <p class="loading-subtitle">Finding the best tweets for you to engage with...</p>
                            </div>
                        </div>

                        <!-- Tweets Section - populated by JavaScript -->
                        <div id="tweets-section" style="display: none;">
                            <!-- Tweets will be rendered here by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create X List Modal -->
<div id="create-list-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="ph ph-plus-circle"></i>
                Add X List
            </h3>
            <button class="modal-close" id="close-create-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="simple-list-name">List Name</label>
                <input type="text" id="simple-list-name" class="form-input" placeholder="Enter list name...">
            </div>
            <div class="form-group">
                <label for="simple-x-list-id">X List ID</label>
                <input type="text" id="simple-x-list-id" class="form-input" placeholder="Enter X List ID...">
            </div>
            <div class="info-box" style="margin-top: 1rem;">
                <i class="ph ph-info"></i>
                <div class="info-content">
                    <div class="info-title">How to find your X List ID</div>
                    <div class="info-text">Go to your list on X and copy the last part from the URL.<br>For example: x.com/i/lists/<strong>1234567890</strong></div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="cancel-create-btn" class="secondary-btn">Cancel</button>
            <button id="simple-create-btn" class="primary-btn">
                <i class="ph ph-plus"></i>
                Add X List
            </button>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loading-modal" class="modal">
    <div class="modal-content">
        <div class="modal-body" style="text-align: center; padding: 2rem;">
            <div class="loading-spinner" style="margin: 0 auto 1rem; width: 32px; height: 32px; border-width: 3px;"></div>
            <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;" id="loading-text">Processing...</h3>
            <p style="color: var(--text-secondary); font-size: 0.875rem;" id="loading-description">Please wait while we process your request.</p>
        </div>
    </div>
</div>

<!-- Edit List Modal -->
<div id="edit-list-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="ph ph-pencil"></i>
                Edit Custom List
            </h3>
            <button class="modal-close" id="close-edit-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">List Name</label>
                <input type="text" id="edit-list-name" class="form-input">
            </div>
            
            <div id="accounts-section" style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Accounts</label>
                <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                    <input type="text" id="new-account-input" class="form-input" placeholder="Add account (without @)" style="flex: 1;">
                    <button id="add-account-btn" class="primary-btn">
                        <i class="ph ph-plus"></i>
                        Add
                    </button>
                </div>
                <div id="edit-account-tags" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    <!-- Account tags will be populated here -->
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="cancel-edit-btn" class="secondary-btn">Cancel</button>
            <button id="save-edit-btn" class="primary-btn">Save Changes</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" style="color: #EF4444;">
                <i class="ph ph-warning"></i>
                Delete List
            </h3>
            <button class="modal-close" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p style="color: var(--text-primary); margin-bottom: 1rem;">Are you sure you want to delete this list? This action cannot be undone.</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem;" id="delete-list-name"></p>
        </div>
        <div class="modal-footer">
            <button id="cancel-delete-btn" class="secondary-btn">Cancel</button>
            <button id="confirm-delete-btn" class="primary-btn" style="background: #EF4444;">Delete</button>
        </div>
    </div>
</div>

{% endblock %}