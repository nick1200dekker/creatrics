{% extends "base.html" %}
{% set check_auth = true %}

{% block title %}AI Content Calendar - Plan & Schedule Your Content Strategy | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Plan and schedule your content strategy with AI-powered content calendar. Organize YouTube videos, social media posts, and track publishing schedules with Creatrics intelligent planning tool.">
<meta name="keywords" content="AI content calendar, content planning, social media scheduler, YouTube planning, content strategy, editorial calendar">
{% endblock %}

{% block additional_styles %}
<!-- Include FullCalendar CSS first -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<link rel="stylesheet" href="{{ url_for('static', filename='css/content_calendar.css') }}">
{% endblock %}

{% block content %}
<div class="calendar-wrapper">
    <!-- Header -->
    <div class="calendar-header">
        <h1 class="calendar-title">
            <i class="ph ph-calendar"></i>
            Content Calendar
        </h1>
        <div class="week-start-toggle">
            <button class="week-toggle-btn active" onclick="setWeekStart(1)">
                Start: Mon
            </button>
            <button class="week-toggle-btn" onclick="setWeekStart(0)">
                Start: Sun
            </button>
        </div>
    </div>
    
    <!-- Controls -->
    <div class="calendar-controls">
        <div class="control-group">
            <button class="btn btn-primary" onclick="openNewEventModal()">
                <i class="ph ph-plus"></i>
                Add Event
            </button>
        </div>

        <div class="view-toggle">
            <button class="view-btn active" onclick="switchView('calendar')">
                <i class="ph ph-calendar"></i>
                Calendar
            </button>
            <button class="view-btn" onclick="switchView('table')">
                <i class="ph ph-table"></i>
                Table
            </button>
            <button class="view-btn" onclick="switchView('kanban')">
                <i class="ph ph-kanban"></i>
                Kanban
            </button>
            <button class="view-btn" onclick="toggleAnalytics()" id="analytics-toggle-btn">
                <i class="ph ph-chart-line"></i>
                Analytics
            </button>
        </div>
        
        <div class="control-group">
            <button class="btn btn-icon" onclick="previousMonth()">
                <i class="ph ph-caret-left"></i>
            </button>
            <span id="current-month" style="min-width: 150px; text-align: center; font-weight: 600; color: var(--text-primary);">
                Loading...
            </span>
            <button class="btn btn-icon" onclick="nextMonth()">
                <i class="ph ph-caret-right"></i>
            </button>
        </div>
    </div>
    
    <!-- Calendar View -->
    <div id="calendar"></div>

    <!-- Analytics Panel -->
    <div id="analytics-panel" class="analytics-panel">
        <!-- Content Type Row -->
        <div class="analytics-section">
            <h3 style="color: var(--text-secondary); font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">Content Type</h3>
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-label">Total Posts</div>
                    <div class="analytics-value" id="total-posts">0</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">Organic Content</div>
                    <div class="analytics-value" id="organic-posts">0</div>
                    <div class="analytics-sub" id="organic-percentage">0%</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">Sponsored Content</div>
                    <div class="analytics-value" id="sponsored-posts">0</div>
                    <div class="analytics-sub" id="sponsored-percentage">0%</div>
                </div>
            </div>
        </div>

        <!-- Status Row -->
        <div class="analytics-section" style="margin-top: 2rem;">
            <h3 style="color: var(--text-secondary); font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">Content Status</h3>
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-label">Draft</div>
                    <div class="analytics-value" id="draft-posts">0</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">Scheduled</div>
                    <div class="analytics-value" id="scheduled-posts">0</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">In Progress</div>
                    <div class="analytics-value" id="progress-posts">0</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">Review</div>
                    <div class="analytics-value" id="review-posts">0</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-label">Ready</div>
                    <div class="analytics-value" id="ready-posts">0</div>
                </div>
            </div>
        </div>

        <!-- Daily Posts Chart -->
        <div class="chart-container">
            <h3 style="color: var(--text-secondary); font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">Posts Per Day</h3>
            <div class="chart-wrapper">
                <div class="chart-y-axis" id="chart-y-axis">
                    <!-- Y-axis labels will be generated dynamically -->
                </div>
                <div class="chart-bars" id="chart-bars">
                    <!-- Bars will be generated dynamically -->
                </div>
                <div class="chart-x-axis" id="chart-x-axis">
                    <!-- X-axis labels will be generated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Table View -->
    <div id="table-view">
        <table class="content-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Platform</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Will be populated by JavaScript -->
            </tbody>
        </table>
    </div>
    
    <!-- Kanban View -->
    <div id="kanban-view">
        <div class="kanban-board">
            <div class="kanban-column" data-status="draft">
                <div class="kanban-column-header">
                    <div class="kanban-column-title">
                        <i class="ph ph-pencil"></i>
                        Draft
                    </div>
                    <span class="kanban-column-count">0</span>
                </div>
                <div class="kanban-column-body" ondrop="dropCard(event)" ondragover="allowDrop(event)">
                    <!-- Cards will be populated here -->
                </div>
            </div>
            
            <div class="kanban-column" data-status="in-progress">
                <div class="kanban-column-header">
                    <div class="kanban-column-title">
                        <i class="ph ph-clock"></i>
                        In Progress
                    </div>
                    <span class="kanban-column-count">0</span>
                </div>
                <div class="kanban-column-body" ondrop="dropCard(event)" ondragover="allowDrop(event)">
                    <!-- Cards will be populated here -->
                </div>
            </div>
            
            <div class="kanban-column" data-status="review">
                <div class="kanban-column-header">
                    <div class="kanban-column-title">
                        <i class="ph ph-eye"></i>
                        Review
                    </div>
                    <span class="kanban-column-count">0</span>
                </div>
                <div class="kanban-column-body" ondrop="dropCard(event)" ondragover="allowDrop(event)">
                    <!-- Cards will be populated here -->
                </div>
            </div>
            
            <div class="kanban-column" data-status="ready">
                <div class="kanban-column-header">
                    <div class="kanban-column-title">
                        <i class="ph ph-check-circle"></i>
                        Ready
                    </div>
                    <span class="kanban-column-count">0</span>
                </div>
                <div class="kanban-column-body" ondrop="dropCard(event)" ondragover="allowDrop(event)">
                    <!-- Cards will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Modal (for both new and edit) -->
<div id="event-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 style="font-size: 1.25rem; font-weight: 600;" id="modal-title">Add New Event</h2>
        </div>
        <div class="modal-body">
            <input type="hidden" id="event-id" value="">
            
            <!-- Content Type Selector -->
            <div class="form-group">
                <label class="form-label">Content Type</label>
                <div class="content-type-selector">
                    <div class="content-type-option selected" data-type="organic" onclick="selectContentType('organic')">
                        Organic Content
                    </div>
                    <div class="content-type-option" data-type="sponsored" onclick="selectContentType('sponsored')">
                        Sponsored Content
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Title *</label>
                <input type="text" id="event-title" class="form-input" placeholder="Event title">
            </div>
            
            <div class="form-group">
                <label class="form-label">Date & Time (optional - leave empty for drafts)</label>
                <div class="date-input-wrapper">
                    <input type="datetime-local" id="event-date" class="form-input"
                           onclick="this.showPicker ? this.showPicker() : this.focus()"
                           placeholder="Click to select date and time">
                    <button type="button" class="date-picker-btn" onclick="document.getElementById('event-date').showPicker ? document.getElementById('event-date').showPicker() : document.getElementById('event-date').click()">
                        <i class="ph ph-calendar"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Platform</label>
                <select id="event-platform" class="form-select">
                    <option value="YouTube">YouTube</option>
                    <option value="X">X (Twitter)</option>
                    <option value="Instagram">Instagram</option>
                    <option value="TikTok">TikTok</option>
                    <option value="Blog">Blog</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Status</label>
                <select id="event-status" class="form-select">
                    <option value="draft">Draft</option>
                    <option value="in-progress">In Progress</option>
                    <option value="review">Review</option>
                    <option value="ready">Ready</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea id="event-notes" class="form-textarea" placeholder="Additional notes..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="deleteEvent()" id="delete-btn" style="margin-right: auto; display: none;">
                <i class="ph ph-trash"></i>
                Delete
            </button>
            <button class="btn" onclick="closeEventModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveEvent()">Save Event</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Include FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@5.11.3/main.min.js'></script>
<script src="{{ url_for('static', filename='scripts/content_calendar.js') }}"></script>
{% endblock %}
