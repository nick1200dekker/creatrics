{% extends "base.html" %}

{% block seo_meta %}
<meta name="description" content="Upload videos directly to TikTok with AI-powered content creation. Connect your TikTok account and publish content with optimized captions and privacy settings.">
<meta name="keywords" content="TikTok upload, TikTok API, video upload, TikTok publishing, content posting, TikTok automation">
{% endblock %}

{% block title %}Upload Studio | Creatrics{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tiktok_upload_studio.css') }}?v=1.1">
<link rel="stylesheet" href="{{ url_for('static', filename='css/repost-modal.css') }}?v=1.2">
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-link-modal.css') }}?v=3">
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="generator-wrapper">
        <!-- Header -->
        <div class="generator-header">
            <h1 class="generator-title">
                <i class="ph ph-upload"></i>
                Upload Studio
            </h1>
        </div>

        <!-- Content Area -->
        <div class="generator-content">
            <!-- Connection Status Card -->
            <div class="connection-card">
                <div class="connection-header">
                    <div class="connection-status">
                        <div class="status-indicator">
                            <div class="status-dot loading"></div>
                            <span class="status-text">Checking connection...</span>
                        </div>

                        <div id="connectionButtons" style="display: none;">
                            <button id="connectBtn" class="secondary-button" style="display: none;">
                                <i class="ph ph-link"></i>
                                <span>Connect TikTok</span>
                            </button>

                            <button id="disconnectBtn" class="btn-disconnect" style="display: none;">
                                <i class="ph ph-plug"></i>
                                Disconnect
                            </button>
                        </div>

                        <!-- Loading skeleton for buttons -->
                        <div id="buttonSkeleton" class="skeleton-loader" style="width: 150px; height: 36px; border-radius: 8px;"></div>
                    </div>

                    <!-- User Info (shown when connected) -->
                    <div id="userInfo" class="user-info" style="display:none;">
                        <img id="userAvatar" src="/static/img/default-avatar.png" alt="User Avatar" class="user-avatar">
                        <div class="user-details">
                            <div class="user-name" id="userName">TikTok User</div>
                            <div class="user-id" id="userOpenId">@username</div>
                        </div>
                    </div>
                </div>

                <!-- Premium Notice for Free Users -->
                <div id="premiumNotice" class="premium-notice" style="display: none;">
                    <div class="premium-icon">ðŸ‘‘</div>
                    <div class="premium-text">
                        <strong>Premium Feature</strong>
                        <p>TikTok Upload Studio requires a Premium Creator subscription to connect and post content.</p>
                    </div>
                    <a href="/payment/checkout" class="premium-upgrade-btn">
                        <i class="ph ph-crown"></i>
                        Upgrade to Premium
                    </a>
                </div>
            </div>

            <!-- Side-by-Side Layout -->
            <div class="editor-grid">
                <!-- Left Panel - Input -->
                <div class="input-section">
                    <div class="input-panel">
                        <!-- Upload/Repost Toggle -->
                        <div class="form-group">
                            <div class="upload-repost-toggle">
                                <button class="toggle-btn active" data-mode="upload" onclick="switchMode('upload')">
                                    <i class="ph ph-upload"></i>
                                    Upload New
                                </button>
                                <button class="toggle-btn" data-mode="repost" onclick="switchMode('repost')">
                                    <i class="ph ph-recycle"></i>
                                    Repost Content
                                </button>
                            </div>
                        </div>

                        <!-- Video Upload Section (Top) -->
                        <div class="form-group" id="videoUploadSectionStatic">
                            <label class="form-label">
                                <i class="ph ph-upload"></i>
                                Video
                            </label>
                            <div class="video-upload-area" id="videoUploadAreaStatic" onclick="triggerVideoUploadStatic()">
                                <input type="file" id="videoFileInputStatic" accept="video/*" style="display: none;" onchange="handleVideoSelectStatic(event)">
                                <div class="upload-content" id="uploadContentStatic">
                                    <i class="ph ph-cloud-arrow-up" style="font-size: 2rem; color: var(--text-tertiary); margin-bottom: 0.25rem;"></i>
                                    <div style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.125rem; font-size: 0.9375rem;">Click to upload video</div>
                                    <div style="color: var(--text-tertiary); font-size: 0.8125rem;">MP4, WebM, or MOV (max 4GB)</div>
                                </div>
                                <div class="upload-progress" id="uploadProgressStatic" style="display: none;">
                                    <div class="upload-file-info">
                                        <i class="ph ph-video" style="font-size: 2rem; color: #3B82F6;"></i>
                                        <div style="flex: 1;">
                                            <div id="uploadFileNameStatic" style="color: var(--text-primary); font-weight: 500;"></div>
                                            <div id="uploadFileSizeStatic" style="color: var(--text-tertiary); font-size: 0.875rem;"></div>
                                        </div>
                                    </div>
                                    <button class="remove-video-btn" onclick="removeVideoStatic(event)" title="Remove video" type="button">
                                        <i class="ph ph-x"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Target Keyword -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="ph ph-key"></i>
                                Target Keyword
                                <div class="info-tooltip">
                                    <i class="ph ph-info"></i>
                                    <span class="tooltip-text">If provided, titles will start with this exact keyword</span>
                                </div>
                            </label>
                            <input type="text"
                                   class="form-input"
                                   id="keywordsInput"
                                   placeholder="e.g., Gaming, FPS, Battlefield 2042">
                        </div>

                        <!-- Video Concept -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="ph ph-article"></i>
                                Video Description or Script
                                <div class="info-tooltip">
                                    <i class="ph ph-info"></i>
                                    <span class="tooltip-text">The more concrete you are about the video, the better the results. Include key topics, main points, and specific details.</span>
                                </div>
                            </label>
                            <textarea class="form-textarea"
                                      id="videoConceptInput"
                                      placeholder="Describe your video content or paste your script..."
                                      maxlength="3000"
                                      oninput="updateCharCount()"></textarea>
                            <div class="char-count" id="charCount">0 / 3000</div>
                        </div>

                        <!-- Generate Button -->
                        <button class="btn-generate" onclick="generateTitles()" id="generateTitlesBtn" type="button">
                            <i class="ph ph-sparkle"></i>
                            Generate Titles & Hashtags
                        </button>
                    </div>
                </div>

                <!-- Right Panel - Results -->
                <div class="output-section">
                    <div class="results-panel">
                        <div id="resultsContainer">
                            <!-- Empty State -->
                            <div class="empty-results">
                                <i class="ph ph-sparkle empty-icon"></i>
                                <div class="empty-title">Ready to Create</div>
                                <div class="empty-text">Generate titles and hashtags, then upload your video to TikTok.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Pass backend variables to JavaScript
    window.hasPremium = {{ 'true' if has_premium else 'false' }};
</script>
<script src="{{ url_for('static', filename='scripts/repost-modal.js') }}?v=1.4"></script>
<script src="{{ url_for('static', filename='scripts/calendar-link-modal.js') }}?v=3"></script>
<script src="{{ url_for('static', filename='scripts/tiktok_upload_studio.js') }}?v=1.4"></script>
{% endblock %}