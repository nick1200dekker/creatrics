{% extends "base.html" %}

{% block title %}Content Wiki - Knowledge Base & Documentation | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Build your content knowledge base with brand guidelines, documentation, templates, and resources. Organize everything your team needs in one centralized wiki.">
<meta name="keywords" content="content wiki, brand guidelines, documentation, knowledge base, content standards, team resources">
{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/content_wiki.css') }}">
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="wiki-wrapper">
        <!-- Left Sidebar -->
        <aside class="wiki-sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">
                    <i class="ph ph-books"></i>
                    Content Wiki
                </h2>
                <button class="new-page-btn" onclick="WikiApp.createNewPage()">
                    <i class="ph ph-plus"></i>
                    New Page
                </button>
            </div>

            <!-- Search -->
            <div class="search-box">
                <div class="search-wrapper">
                    <input type="text" 
                           class="search-input" 
                           id="searchInput" 
                           placeholder="Search wiki..."
                           onkeyup="WikiApp.searchDebounced(this.value)">
                    <i class="ph ph-magnifying-glass search-icon"></i>
                </div>
            </div>

            <!-- Categories -->
            <div class="categories-section">
                <div class="categories-header">
                    <span class="categories-title">Categories</span>
                    <button class="view-all-btn" onclick="WikiApp.showAllPages()">
                        All
                    </button>
                </div>
                <div class="categories-list" id="categoriesList">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- Pages List -->
            <div class="pages-section">
                <div class="pages-header">
                    <span class="pages-title" id="pagesTitle">All Pages</span>
                    <span class="pages-count" id="pagesCount">0</span>
                </div>
                <div class="pages-list" id="pagesList">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Pinned Pages -->
            <div class="pinned-section" id="pinnedSection" style="display: none;">
                <div class="pinned-header">
                    <i class="ph ph-push-pin"></i>
                    <span>Pinned</span>
                </div>
                <div class="pinned-list" id="pinnedList">
                    <!-- Pinned pages will be loaded here -->
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="wiki-content" id="wikiContent">
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <i class="ph ph-books empty-state-icon"></i>
                <h2 class="empty-state-title">Welcome to Content Wiki</h2>
                <p class="empty-state-text">Create your first documentation page or select one to get started</p>
                <button class="action-btn" onclick="WikiApp.createNewPage()">
                    <i class="ph ph-plus"></i>
                    <span>Create Your First Page</span>
                </button>

                <!-- Templates Section -->
                <div class="templates-showcase">
                    <h3>Start with a Template</h3>
                    <div class="template-cards">
                        <div class="template-card" onclick="WikiApp.createFromTemplate('brand-guidelines')">
                            <i class="ph ph-palette"></i>
                            <span>Brand Guidelines</span>
                        </div>
                        <div class="template-card" onclick="WikiApp.createFromTemplate('content-standards')">
                            <i class="ph ph-file-text"></i>
                            <span>Content Standards</span>
                        </div>
                        <div class="template-card" onclick="WikiApp.createFromTemplate('editor-letter')">
                            <i class="ph ph-envelope"></i>
                            <span>Letter to Editors</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page Editor -->
            <div class="page-editor" id="pageEditor" style="display: none;">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-header-top">
                        <input type="text" 
                               class="page-title-input" 
                               id="pageTitle" 
                               placeholder="Page Title"
                               autocomplete="off">
                        <div class="page-actions">
                            <button class="icon-btn" onclick="WikiApp.togglePagePin()" title="Pin Page" id="pinBtn">
                                <i class="ph ph-push-pin"></i>
                            </button>
                            <button class="icon-btn" onclick="WikiApp.duplicatePage()" title="Duplicate">
                                <i class="ph ph-copy"></i>
                            </button>
                            <button class="icon-btn" onclick="WikiApp.showPageInfo()" title="Page Info">
                                <i class="ph ph-info"></i>
                            </button>
                            <button class="icon-btn danger" onclick="WikiApp.deletePage()" title="Delete">
                                <i class="ph ph-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Category and Tags -->
                    <div class="page-metadata">
                        <select class="category-select" id="pageCategory">
                            <!-- Categories will be loaded here -->
                        </select>
                        <div class="tags-input-wrapper">
                            <input type="text" 
                                   class="tags-input" 
                                   id="pageTags" 
                                   placeholder="Add tags (comma separated)">
                        </div>
                    </div>
                </div>

                <!-- Editor Toolbar -->
                <div class="editor-toolbar">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('bold')" title="Bold">
                            <i class="ph ph-text-b"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('italic')" title="Italic">
                            <i class="ph ph-text-italic"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('underline')" title="Underline">
                            <i class="ph ph-text-underline"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('strikeThrough')" title="Strikethrough">
                            <i class="ph ph-text-strikethrough"></i>
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'h1')" title="Heading 1">
                            H1
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'h2')" title="Heading 2">
                            H2
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'h3')" title="Heading 3">
                            H3
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'p')" title="Paragraph">
                            P
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('insertUnorderedList')" title="Bullet List">
                            <i class="ph ph-list-bullets"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('insertOrderedList')" title="Numbered List">
                            <i class="ph ph-list-numbers"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertTable()" title="Insert Table">
                            <i class="ph ph-table"></i>
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.insertLink()" title="Link">
                            <i class="ph ph-link"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertImage()" title="Image">
                            <i class="ph ph-image"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.uploadAttachment()" title="Attach File">
                            <i class="ph ph-paperclip"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertCode()" title="Code Block">
                            <i class="ph ph-code"></i>
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <div class="color-picker-wrapper">
                            <input type="color" id="textColorPicker" onchange="WikiApp.changeTextColor(this.value)">
                            <button class="toolbar-btn" onclick="document.getElementById('textColorPicker').click()" title="Text Color">
                                <i class="ph ph-palette"></i>
                            </button>
                        </div>
                        <div class="color-picker-wrapper">
                            <input type="color" id="bgColorPicker" onchange="WikiApp.changeBgColor(this.value)">
                            <button class="toolbar-btn" onclick="document.getElementById('bgColorPicker').click()" title="Background Color">
                                <i class="ph ph-paint-bucket"></i>
                            </button>
                        </div>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'blockquote')" title="Quote">
                            <i class="ph ph-quotes"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertCallout('info')" title="Info Callout">
                            <i class="ph ph-info"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertCallout('warning')" title="Warning Callout">
                            <i class="ph ph-warning"></i>
                        </button>
                    </div>
                </div>

                <!-- Content Editor -->
                <div class="editor-content">
                    <div id="wikiEditor" contenteditable="true" class="wiki-editor"></div>
                </div>

                <!-- Attachments Section -->
                <div class="attachments-section" id="attachmentsSection" style="display: none;">
                    <div class="attachments-header">
                        <i class="ph ph-paperclip"></i>
                        <span>Attachments</span>
                    </div>
                    <div class="attachments-list" id="attachmentsList">
                        <!-- Attachments will be listed here -->
                    </div>
                </div>

                <!-- Save Status -->
                <div class="editor-footer">
                    <div class="save-status saved" id="saveStatus">
                        <i class="ph ph-check-circle"></i>
                        <span>Saved</span>
                    </div>
                    <div class="page-info">
                        <span id="pageVersion">v1</span>
                        <span id="lastEdited">Just now</span>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Hidden file input for uploads -->
<input type="file" id="fileUpload" style="display: none;" accept="*/*" onchange="WikiApp.handleFileUpload(this)">
<input type="file" id="imageUpload" style="display: none;" accept="image/*" onchange="WikiApp.handleImageUpload(this)">

<!-- Page Info Modal -->
<div class="modal" id="pageInfoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Page Information</h3>
            <button class="modal-close" onclick="WikiApp.closePageInfo()">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-body" id="pageInfoContent">
            <!-- Page info will be displayed here -->
        </div>
    </div>
</div>

<!-- Template for attachment item -->
<template id="attachmentTemplate">
    <div class="attachment-item">
        <i class="ph ph-file"></i>
        <span class="attachment-name"></span>
        <span class="attachment-size"></span>
        <button class="attachment-remove" onclick="WikiApp.removeAttachment(this)">
            <i class="ph ph-x"></i>
        </button>
    </div>
</template>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/content_wiki.js') }}"></script>
{% endblock %}