{% extends "base.html" %}

{% block title %}Content Wiki - Knowledge Base & Documentation | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Build your content knowledge base with brand guidelines, documentation, templates, and resources. Organize everything your team needs in one centralized wiki.">
<meta name="keywords" content="content wiki, brand guidelines, documentation, knowledge base, content standards, team resources">
{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/content_wiki.css') }}">
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="wiki-wrapper">
        <!-- Header -->
        <div class="wiki-header">
            <h1 class="wiki-title">
                <i class="ph ph-books"></i>
                Content Wiki
            </h1>
        </div>

        <!-- Main Content Area -->
        <main class="wiki-content" id="wikiContent">
            <!-- Category Overview (Default View) -->
            <div class="category-overview" id="categoryOverview">
                <div class="category-grid">
                    <!-- Category cards will be displayed here -->
                </div>

                <!-- Storage Usage -->
                <div class="storage-usage-container" id="storageUsageContainer" style="display: none;">
                    <div class="storage-usage-header">
                        <div class="storage-usage-title">
                            <i class="ph ph-hard-drives"></i>
                            Storage Usage
                        </div>
                        <div class="storage-usage-text">
                            <span id="storageUsedMB">0</span> MB / 1024 MB
                        </div>
                    </div>
                    <div class="storage-usage-bar">
                        <div class="storage-usage-fill" id="storageUsageFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Category Space View -->
            <div class="category-space" id="categorySpace" style="display: none;">
                <!-- Category Header -->
                <div class="space-header">
                    <button class="back-btn" onclick="WikiApp.showOverview()">
                        <i class="ph ph-arrow-left"></i>
                    </button>
                    <div class="space-info">
                        <h1 class="space-title" id="spaceTitle">
                            <span class="space-icon" id="spaceIcon"></span>
                            <span class="space-name" id="spaceName"></span>
                        </h1>
                        <div class="space-stats">
                            <span class="stat-badge">
                                <i class="ph ph-file-text"></i>
                                <span id="spaceDocs">0</span> pages
                            </span>
                            <span class="stat-badge">
                                <i class="ph ph-folder"></i>
                                <span id="spaceFolders">0</span> folders
                            </span>
                            <span class="stat-badge">
                                <i class="ph ph-paperclip"></i>
                                <span id="spaceFiles">0</span> files
                            </span>
                        </div>
                    </div>
                    <div class="space-actions">
                        <button class="action-btn secondary" onclick="WikiApp.uploadFile()">
                            <i class="ph ph-upload"></i>
                            Upload File
                        </button>
                        <button class="action-btn secondary" onclick="WikiApp.createFolder()">
                            <i class="ph ph-folder-plus"></i>
                            New Folder
                        </button>
                        <button class="action-btn primary" onclick="WikiApp.createDocument()">
                            <i class="ph ph-plus"></i>
                            New Page
                        </button>
                    </div>
                </div>

            <!-- Content Controls -->
                <div class="content-controls">
                    <div class="search-wrapper">
                        <input type="text" 
                               class="search-input" 
                               id="workspaceSearch" 
                               placeholder="Search in this space..."
                               onkeyup="WikiApp.searchInSpace(this.value)">
                        <i class="ph ph-magnifying-glass search-icon"></i>
                    </div>
                    <div class="filter-tabs">
                        <button class="filter-tab active" onclick="WikiApp.filterContent('all')">
                            All
                        </button>
                        <button class="filter-tab" onclick="WikiApp.filterContent('folders')">
                            <i class="ph ph-folder"></i>
                            Folders
                        </button>
                        <button class="filter-tab" onclick="WikiApp.filterContent('documents')">
                            <i class="ph ph-file-text"></i>
                            Pages
                        </button>
                        <button class="filter-tab" onclick="WikiApp.filterContent('files')">
                            <i class="ph ph-paperclip"></i>
                            Files
                        </button>
                    </div>
                    <div class="view-options">
                        <button class="view-toggle active" onclick="WikiApp.setView('grid')" title="Grid View">
                            <i class="ph ph-grid-four"></i>
                        </button>
                        <button class="view-toggle" onclick="WikiApp.setView('list')" title="List View">
                            <i class="ph ph-list"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="content-loading" id="contentLoading" style="display: none;">
                    <div class="content-loading-spinner"></div>
                    <p class="content-loading-text">Loading...</p>
                </div>

                <!-- Content Grid -->
                <div class="content-grid" id="contentGrid">
                    <!-- Content cards will be displayed here -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="ph ph-folder-open empty-state-icon"></i>
                    <h3 class="empty-state-title">No content yet</h3>
                    <p class="empty-state-text">Start by creating a document or uploading a file</p>
                    <div class="empty-state-actions">
                        <button class="action-btn secondary" onclick="WikiApp.uploadFile()">
                            <i class="ph ph-upload"></i>
                            Upload File
                        </button>
                        <button class="action-btn primary" onclick="WikiApp.createDocument()">
                            <i class="ph ph-plus"></i>
                            Create Document
                        </button>
                    </div>
                </div>
            </div>

            <!-- Document Editor -->
            <div class="document-editor" id="documentEditor" style="display: none;">
                <!-- Editor Header -->
                <div class="editor-header">
                    <button class="back-btn" onclick="WikiApp.closeEditor()">
                        <i class="ph ph-arrow-left"></i>
                    </button>
                    <input type="text" 
                           class="document-title-input" 
                           id="documentTitle" 
                           placeholder="Document Title"
                           autocomplete="off">
                    <div class="editor-actions">
                        <button class="icon-btn" onclick="WikiApp.downloadDocument()" title="Download">
                            <i class="ph ph-download"></i>
                        </button>
                        <button class="icon-btn" onclick="WikiApp.togglePin()" title="Pin Document" id="pinBtn">
                            <i class="ph ph-push-pin"></i>
                        </button>
                        <button class="icon-btn" onclick="WikiApp.duplicateDocument()" title="Duplicate">
                            <i class="ph ph-copy"></i>
                        </button>
                        <button class="icon-btn" onclick="WikiApp.showDocInfo()" title="Document Info">
                            <i class="ph ph-info"></i>
                        </button>
                        <button class="icon-btn danger" onclick="WikiApp.deleteDocument()" title="Delete">
                            <i class="ph ph-trash"></i>
                        </button>
                    </div>
                </div>

                <!-- Editor Toolbar -->
                <div class="editor-toolbar">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('bold')" title="Bold">
                            <i class="ph ph-text-b"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('italic')" title="Italic">
                            <i class="ph ph-text-italic"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('underline')" title="Underline">
                            <i class="ph ph-text-underline"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('strikeThrough')" title="Strikethrough">
                            <i class="ph ph-text-strikethrough"></i>
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'h1')" title="Heading 1">
                            H1
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'h2')" title="Heading 2">
                            H2
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('formatBlock', 'h3')" title="Heading 3">
                            H3
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.formatText('insertUnorderedList')" title="Bullet List">
                            <i class="ph ph-list-bullets"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.formatText('insertOrderedList')" title="Numbered List">
                            <i class="ph ph-list-numbers"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertTable()" title="Insert Table">
                            <i class="ph ph-table"></i>
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="WikiApp.insertLink()" title="Link">
                            <i class="ph ph-link"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertImage()" title="Image">
                            <i class="ph ph-image"></i>
                        </button>
                        <button class="toolbar-btn" onclick="WikiApp.insertCode()" title="Code Block">
                            <i class="ph ph-code"></i>
                        </button>
                    </div>
                </div>

                <!-- Editor Content -->
                <div class="editor-content">
                    <div id="wikiEditor" contenteditable="true" class="wiki-editor"></div>
                </div>

                <!-- Editor Footer -->
                <div class="editor-footer">
                    <div class="save-status saved" id="saveStatus">
                        <i class="ph ph-check-circle"></i>
                        <span>Saved</span>
                    </div>
                    <div class="page-info">
                        <span id="docVersion">v1</span>
                        <span id="lastEdited">Just now</span>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Hidden file inputs -->
<input type="file" id="fileUpload" style="display: none;" accept="*/*" onchange="WikiApp.handleFileUpload(this)">
<input type="file" id="imageUpload" style="display: none;" accept="image/*" onchange="WikiApp.handleImageUpload(this)">

<!-- Modals -->
<!-- Document Info Modal -->
<div class="modal" id="docInfoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Document Information</h3>
            <button class="modal-close" onclick="WikiApp.closeDocInfo()">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-body" id="docInfoContent">
            <!-- Document info will be displayed here -->
        </div>
    </div>
</div>

<!-- File Preview Modal -->
<div class="modal" id="filePreviewModal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="filePreviewTitle">File Preview</h3>
            <div class="modal-actions">
                <button class="icon-btn" onclick="WikiApp.renameFile()" title="Rename">
                    <i class="ph ph-pencil"></i>
                </button>
                <button class="icon-btn" onclick="WikiApp.downloadFile()" title="Download">
                    <i class="ph ph-download"></i>
                </button>
                <button class="icon-btn" onclick="WikiApp.deleteFile()" title="Delete" style="color: #EF4444;">
                    <i class="ph ph-trash"></i>
                </button>
                <button class="modal-close" onclick="WikiApp.closeFilePreview()">
                    <i class="ph ph-x"></i>
                </button>
            </div>
        </div>
        <div class="modal-body" id="filePreviewContent">
            <!-- File preview will be displayed here -->
        </div>
    </div>
</div>

<!-- Rename Modal -->
<div class="modal" id="renameModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Rename</h3>
            <button class="modal-close" onclick="WikiApp.closeRenameModal()">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-body">
            <input type="text"
                   id="renameInput"
                   class="folder-name-input"
                   placeholder="Enter new name..."
                   onkeypress="if(event.key==='Enter') WikiApp.confirmRename()">
        </div>
        <div class="modal-footer">
            <button class="action-btn secondary" onclick="WikiApp.closeRenameModal()">
                Cancel
            </button>
            <button class="action-btn primary" onclick="WikiApp.confirmRename()">
                Rename
            </button>
        </div>
    </div>
</div>

<!-- New Folder Modal -->
<div class="modal" id="newFolderModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New Folder</h3>
            <button class="modal-close" onclick="WikiApp.closeFolderModal()">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-body">
            <input type="text"
                   id="folderNameInput"
                   class="folder-name-input"
                   placeholder="Folder name..."
                   onkeypress="if(event.key==='Enter') WikiApp.confirmCreateFolder()">
        </div>
        <div class="modal-footer">
            <button class="action-btn secondary" onclick="WikiApp.closeFolderModal()">
                Cancel
            </button>
            <button class="action-btn primary" onclick="WikiApp.confirmCreateFolder()">
                <i class="ph ph-folder-plus"></i>
                Create Folder
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/content_wiki.js') }}"></script>
{% endblock %}
