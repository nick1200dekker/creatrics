{% extends "base.html" %}

{% block title %}AI Twitter Spaces Processor - Transcribe & Analyze | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Process Twitter Spaces with AI. Get transcriptions, summaries, key highlights, and downloadable audio clips. Professional Spaces analysis made simple with Creatrics AI.">
<meta name="keywords" content="AI Twitter Spaces processor, Spaces transcription, audio analysis, social media analytics, X Spaces">
{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/clip_spaces.css') }}">
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="generator-wrapper">
        <!-- Header -->
        <div class="generator-header">
            <h1 class="generator-title">
                <i class="ph ph-broadcast"></i>
                Spaces
            </h1>
            <div class="header-actions">
                <button class="header-btn" onclick="toggleHowItWorks()">
                    <i class="ph ph-question"></i>
                    How It Works
                </button>
                <a href="{{ url_for('home.dashboard') }}" class="header-btn">
                    <i class="ph ph-house"></i>
                    Dashboard
                </a>
            </div>
        </div>

        <!-- Content Area -->
        <div class="generator-content">
            <!-- How It Works Section -->
            <div class="how-it-works-section" id="howItWorksSection">
                <div class="how-it-works-title">
                    <i class="ph ph-lightbulb"></i>
                    How to Use Spaces
                </div>
                <div class="how-it-works-step">
                    <div class="step-number">1</div>
                    <div class="step-content">Go to Twitter (X) and find a Space you want to analyze. The Space ID is the string at the end of the URL (e.g., for https://twitter.com/i/spaces/1lPJqMZNDNAJb, the ID is "1lPJqMZNDNAJb").</div>
                </div>
                <div class="how-it-works-step">
                    <div class="step-number">2</div>
                    <div class="step-content">Enter the Space ID in the input field and click "Process Space". The tool will download the Space audio, transcribe it using ElevenLabs Scribe AI, and generate a comprehensive summary. Processing costs credits based on audio duration.</div>
                </div>
                <div class="how-it-works-step">
                    <div class="step-number">3</div>
                    <div class="step-content">Listen to the Space audio, read the AI-generated summary, and browse the full transcript with precise timestamps to gain insights from the conversation. Previous analyses are saved in your History.</div>
                </div>
                <div class="how-it-works-step">
                    <div class="step-number">4</div>
                    <div class="step-content">Use the audio editing tools to select and export specific segments of the Space. Create clips of the best moments to share or save for later.</div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <div class="input-panel">
                    <div class="form-group">
                        <label class="form-label">Process Twitter Space</label>
                        <div class="input-helper">
                            <i class="ph ph-info"></i>
                            Enter the Space ID from a Twitter/X Spaces URL to get AI transcription, summary, and downloadable clips.
                        </div>
                        <div class="input-group">
                            <input type="text" 
                                   class="form-input" 
                                   id="spaceId" 
                                   placeholder="e.g., 1lPJqMZNDNAJb"
                                   maxlength="100">
                            <button class="secondary-button" onclick="toggleHistory()">
                                <i class="ph ph-clock-clockwise"></i>
                                History
                            </button>
                            <button class="process-button" onclick="processSpace()" id="processBtn">
                                <i class="ph ph-sparkle"></i>
                                Process Space
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Panel -->
            <div class="history-panel" id="historyPanel">
                <div class="history-title">
                    <i class="ph ph-clock-clockwise"></i>
                    Previously Processed Spaces
                </div>
                <div id="historyContent">
                    {% if processed_spaces %}
                        {% for space in processed_spaces %}
                        <div class="history-item" onclick="loadSpace('{{ space.space_id }}')">
                            <div class="history-item-icon">
                                <i class="ph ph-broadcast"></i>
                            </div>
                            <div class="history-item-content">
                                <div class="history-item-title">{{ space.title or 'Twitter Space' }}</div>
                                <div class="history-item-meta">Space ID: {{ space.space_id }}</div>
                            </div>
                            <div class="history-item-date">
                                {{ space.formatted_date or 'Recently' }}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            No previously processed spaces found.
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Loading Section -->
            <div class="loading-section" id="loadingSection">
                <div class="loading-spinner"></div>
                <div class="loading-title">Processing Space</div>
                <div class="loading-status" id="loadingStatus">Initializing...</div>
                <div class="loading-progress-container">
                    <div class="loading-progress" id="loadingProgress" style="width: 0%"></div>
                </div>
            </div>

            <!-- Insufficient Credits Section -->
            <div class="insufficient-credits-section" id="insufficientCreditsSection">
                <div class="credit-icon">
                    <i class="ph ph-coins"></i>
                </div>
                <div class="credits-title">Insufficient Credits</div>
                <div class="credits-description" id="creditsDescription">
                    You don't have enough credits to process this Space.
                </div>
                <a href="/payment" class="upgrade-btn">
                    <i class="ph ph-crown"></i>
                    Upgrade Plan
                </a>
            </div>

            <!-- Error Section -->
            <div class="error-section" id="errorSection">
                <div class="error-icon">
                    <i class="ph ph-warning-circle"></i>
                </div>
                <div class="error-title">Error Processing Space</div>
                <div class="error-text" id="errorText">
                    An error occurred while processing the Space. Please try again.
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <!-- Space Info Card -->
                <div class="space-info-card">
                    <div class="space-info-title">
                        <i class="ph ph-info"></i>
                        Space Information
                    </div>
                    <div class="space-info-grid">
                        <div class="space-details">
                            <h4 id="spaceTitle">Space Title</h4>
                            <div class="space-detail-item" id="spaceCreator">Creator: </div>
                            <div class="space-detail-item" id="spaceDate">Date: </div>
                            <div class="space-detail-item" id="spaceListeners">Listeners: </div>
                        </div>
                        <div class="participants-section">
                            <h4>Participants</h4>
                            <div class="participants-list" id="participantsList">
                                <!-- Participants will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Player Card -->
                <div class="audio-player-card">
                    <div class="audio-player-title">
                        <i class="ph ph-play"></i>
                        Listen & Edit Space
                    </div>
                    <div class="w-full">
                        <div id="audioEditorContainer" data-space-id=""></div>
                    </div>
                </div>

                <!-- Summary Card -->
                <div class="summary-card">
                    <div class="summary-header">
                        <div class="summary-title">
                            <i class="ph ph-sparkle"></i>
                            Space Summary & Highlights
                        </div>
                        <div class="summary-tabs">
                            <button class="summary-tab active" onclick="switchTab('overview')" id="overviewTab">
                                Overview
                            </button>
                            <button class="summary-tab" onclick="switchTab('quotes')" id="quotesTab">
                                Key Quotes & Highlights
                            </button>
                        </div>
                    </div>
                    <div class="summary-content">
                        <div class="tab-panel active" id="overviewPanel">
                            <div class="summary-text" id="overviewContent">
                                <!-- Overview content will be populated here -->
                            </div>
                        </div>
                        <div class="tab-panel" id="quotesPanel">
                            <div class="quotes-list" id="quotesContent">
                                <!-- Key quotes content will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transcript Card -->
                <div class="transcript-card">
                    <div class="transcript-header">
                        <div class="transcript-title">
                            <i class="ph ph-text-align-left"></i>
                            Full Transcript
                        </div>
                        <div>
                            <div class="transcript-info" id="transcriptInfo">0 characters</div>
                            <button class="toggle-transcript-btn" onclick="toggleTranscript()" id="toggleTranscriptBtn">
                                <i class="ph ph-eye"></i>
                                Show Transcript
                            </button>
                        </div>
                    </div>
                    <div class="transcript-content" id="transcriptContent">
                        <!-- Transcript will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- WaveSurfer.js from CDN -->
<script src="https://unpkg.com/wavesurfer.js@6.6.4/dist/wavesurfer.js"></script>
<script src="https://unpkg.com/wavesurfer.js@6.6.4/dist/plugin/wavesurfer.timeline.js"></script>
<script src="https://unpkg.com/wavesurfer.js@6.6.4/dist/plugin/wavesurfer.regions.js"></script>

<!-- Markdown renderer -->
<script src="https://unpkg.com/marked@4.0.0/marked.min.js"></script>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/clip_spaces.js') }}"></script>
{% endblock %}