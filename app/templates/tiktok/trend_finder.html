{% extends "base.html" %}

{% block title %}Trend Finder | Creatrics{% endblock %}

{% block seo_meta %}
<meta name="description" content="Discover top gaming trends on TikTok with AI-powered keyword analysis.">
<meta name="keywords" content="TikTok trends, gaming trends, viral hashtags, trend analysis">
{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tiktok_trend_finder.css') }}">
{% endblock %}

{% block content %}
<div class="content-panel">
    <div class="trend-finder-wrapper">
        <!-- Header -->
        <div class="trend-header">
            <div class="header-left">
                <h1 class="trend-title">
                    <i class="ph ph-trend-up"></i>
                    Trend Finder
                </h1>
            </div>
            <div class="header-right">
                <!-- is_admin = {{ is_admin }}, subscription_plan = {{ subscription_plan }} -->
                {% if is_admin %}
                <button class="refresh-btn" id="refreshBtn" onclick="startAnalysis()">
                    <i class="ph ph-arrow-clockwise"></i>
                    Refresh Analysis
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Legal Disclaimer - Collapsible -->
        <div style="margin-bottom: 1rem;">
            <details style="background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 0.75rem 1rem; cursor: pointer; font-size: 0.875rem; color: #856404; font-weight: 500; user-select: none;">
                    ⚠️ Data Source Notice (click to expand)
                </summary>
                <div style="padding: 0 1rem 1rem 1rem; color: #856404; font-size: 0.85rem; line-height: 1.5;">
                    <p style="margin: 0.5rem 0 0 0;">
                        TikTok trend data is collected from publicly available sources via third-party aggregation services.
                        Data may not be real-time or 100% accurate. Creatrics is not affiliated with TikTok.
                    </p>
                </div>
            </details>
        </div>

        <!-- Loading State (Initial Page Load) -->
        <div class="loading-container" id="initialLoading" style="display: flex;">
            <div class="loading-spinner">
                <i class="ph ph-spinner"></i>
                <p>Loading cached trends...</p>
            </div>
        </div>

        <!-- Progress Section (During Analysis) -->
        <div class="progress-section" id="progressSection" style="display: none;">
            <div class="progress-card">
                <div class="progress-header">
                    <div class="progress-icon">
                        <i class="ph ph-spinner"></i>
                    </div>
                    <h2 class="progress-title">Analyzing Trends</h2>
                    <p class="progress-subtitle">This may take a moment while we analyze trending content...</p>
                </div>
                <div class="progress-body">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-info">
                        <span class="progress-text" id="progressText">Starting analysis...</span>
                        <span class="progress-percent" id="progressPercent">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <div class="results-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Keywords</div>
                        <div class="stat-value" id="totalKeywordsStat">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Gaming Keywords</div>
                        <div class="stat-value" id="gamingKeywordsStat">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Analyzed</div>
                        <div class="stat-value" id="analyzedKeywordsStat">0</div>
                    </div>
                </div>
            </div>

            <div class="results-table-wrapper">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th class="rank-col">#</th>
                            <th class="keyword-col">Keyword</th>
                            <th class="score-col">Total Score</th>
                            <th class="score-col">Hot Score</th>
                            <th class="score-col">Engagement</th>
                            <th class="videos-col">Videos</th>
                            <th class="views-col">Avg Views</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <tr>
                            <td colspan="7" class="no-results">No results yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">
                <i class="ph ph-trend-up"></i>
            </div>
            <h3>Discover Gaming Trends</h3>
            <p>Click "Refresh Analysis" to find the latest trending gaming keywords on TikTok</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/tiktok_trend_finder.js') }}"></script>
{% endblock %}