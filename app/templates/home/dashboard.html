{% extends "base.html" %}

{% block title %}Dashboard - Creatrics{% endblock %}

{% block additional_styles %}
<style>
/* ========================================
   REFINED DASHBOARD DESIGN
   Aligned with base.html design system
   ======================================== */

/* Reset default content-panel padding */
.content-panel {
    padding: 0 !important;
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
}

/* Dashboard wrapper - Clean and professional */
.dashboard-wrapper {
    background: var(--bg-secondary);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-secondary);
    overflow: hidden;
    width: 100%;
    min-height: calc(100vh - 60px);
    transition: background-color 0.3s ease, border-color 0.3s ease;
    position: relative;
}

html.dark .dashboard-wrapper {
    border-color: transparent;
    box-shadow: 0 20px 40px -20px rgba(0, 0, 0, 0.5);
}

/* Dashboard container */
.dashboard-container {
    padding: 2rem;
    position: relative;
    z-index: 1;
}

/* Header section - Professional gradient */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 2rem;
    min-height: 120px;
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.06) 0%, 
        rgba(37, 99, 235, 0.06) 100%);
    border-radius: 16px;
    border: 1px solid rgba(59, 130, 246, 0.12);
    position: relative;
    overflow: hidden;
}

html.dark .dashboard-header {
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.08) 0%, 
        rgba(37, 99, 235, 0.08) 100%);
    border-color: rgba(59, 130, 246, 0.15);
}

.welcome-content {
    flex: 1;
}

.welcome-title {
    font-size: 2.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
}

.welcome-title span {
    color: #3B82F6;
    font-weight: 800;
}

.welcome-subtitle {
    font-size: 1rem;
    color: var(--text-secondary);
}

/* Stats Cards */
.header-stats {
    display: flex;
    gap: 2rem;
    align-items: center;
}

.header-stat {
    text-align: center;
    padding: 1rem 1.5rem;
    background: transparent;
    border-radius: 12px;
    border: 1px solid var(--border-primary);
    min-width: 100px;
    transition: all 0.2s ease;
}

.header-stat:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: rgba(59, 130, 246, 0.2);
    background: rgba(59, 130, 246, 0.03);
}

.stat-value {
    font-size: 1.875rem;
    font-weight: 700;
    color: #3B82F6;
    line-height: 1;
}

.stat-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.375rem;
    font-weight: 600;
}

/* Channels Grid */
.channels-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

/* Channel Card */
.channel-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
}

html.dark .channel-card {
    background: var(--bg-secondary);
    border-color: var(--border-primary);
}

.channel-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
    border-color: rgba(59, 130, 246, 0.2);
}

.channel-header {
    padding: 1.25rem;
    background: var(--bg-tertiary);
    border-bottom: 1px solid var(--border-primary);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

html.dark .channel-header {
    background: var(--bg-tertiary);
}

.channel-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.channel-icon {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.375rem;
    color: white;
}

.channel-icon.youtube { 
    background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
}
.channel-icon.x { 
    background: linear-gradient(135deg, #000000 0%, #333333 100%);
}
html.dark .channel-icon.x { 
    background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);
}
.channel-icon.tiktok { 
    background: linear-gradient(135deg, #000000 0%, #333333 100%);
}
html.dark .channel-icon.tiktok { 
    background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);
}

.channel-name h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.channel-username {
    font-size: 0.813rem;
    color: var(--text-tertiary);
}

.view-analytics-btn {
    padding: 0.5rem 1rem;
    background: transparent;
    color: #3B82F6;
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 8px;
    font-size: 0.813rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
}

.view-analytics-btn:hover {
    background: rgba(59, 130, 246, 0.1);
    border-color: #3B82F6;
    transform: translateY(-1px);
}

html.dark .view-analytics-btn {
    color: #60A5FA;
    border-color: rgba(96, 165, 250, 0.3);
}

html.dark .view-analytics-btn:hover {
    background: rgba(96, 165, 250, 0.15);
    border-color: #60A5FA;
}

/* Channel Metrics */
.channel-metrics {
    padding: 1.25rem;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.metric-item {
    text-align: center;
    padding: 0.875rem 0.5rem;
    border-radius: 8px;
    background: var(--bg-tertiary);
    transition: all 0.2s ease;
}

html.dark .metric-item {
    background: var(--bg-tertiary);
}

.metric-item:hover {
    background: var(--hover-bg);
    transform: translateY(-1px);
}

.metric-value {
    font-size: 1.375rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
}

.metric-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    margin-top: 0.25rem;
}

/* Quick Actions Section */
.quick-actions-section {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 16px;
    padding: 2.5rem 0;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

html.dark .quick-actions-section {
    background: var(--bg-secondary);
}

.quick-actions-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 0 2rem;
}

.quick-actions-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.quick-actions-subtitle {
    font-size: 0.938rem;
    color: var(--text-secondary);
}

/* Carousel Container */
.carousel-container {
    position: relative;
    padding: 0 2rem;
}

.carousel-wrapper {
    overflow: hidden;
    position: relative;
}

.carousel-track {
    display: flex;
    gap: 1rem;
    transition: transform 0.5s ease;
}

.carousel-track.auto-scrolling {
    animation: autoScroll 35s linear infinite;
}

.carousel-track:hover {
    animation-play-state: paused;
}

@keyframes autoScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

/* Action Cards */
.action-card {
    flex-shrink: 0;
    width: 240px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: 1.75rem 1.5rem;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

html.dark .action-card {
    background: var(--bg-tertiary);
}

.action-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: rgba(59, 130, 246, 0.3);
}

.action-icon-wrapper {
    width: 56px;
    height: 56px;
    background: rgba(59, 130, 246, 0.1);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
}

.action-icon-wrapper i {
    font-size: 1.5rem;
    color: #3B82F6;
}

.action-card-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.375rem;
}

.action-card-desc {
    font-size: 0.813rem;
    color: var(--text-tertiary);
    line-height: 1.3;
}

/* Platform Indicator */
.platform-badge {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    width: 28px;
    height: 28px;
    background: var(--bg-tertiary);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    border: 1px solid var(--border-primary);
}

.platform-badge.youtube { color: #FF0000; }
.platform-badge.x { color: var(--text-primary); }
.platform-badge.tiktok { color: var(--text-primary); }

/* Connect Channel Card */
.connect-channel-card {
    background: var(--bg-tertiary);
    border: 2px dashed var(--border-primary);
    opacity: 0.8;
    display: flex;
    flex-direction: column;
    text-align: center;
    padding: 2rem;
    transition: all 0.3s ease;
    height: 100%;
}

html.dark .connect-channel-card {
    background: var(--bg-tertiary);
}

.connect-channel-card:hover {
    opacity: 1;
    border-color: rgba(59, 130, 246, 0.4);
    transform: scale(1.02);
}

.connect-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    flex: 1;
}

.connect-content h3 {
    font-size: 1.125rem;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.connect-content p {
    font-size: 0.875rem;
    color: var(--text-tertiary);
    margin-bottom: 1.5rem;
}

.connect-btn {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: auto;
}

.connect-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

/* Calendar Section */
.calendar-section {
    background: transparent;
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: 1.75rem;
    margin-bottom: 2rem;
}

html.dark .calendar-section {
    background: transparent;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.calendar-header h2 {
    font-size: 1.375rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.calendar-header i {
    color: #3B82F6;
}

.view-calendar-btn {
    padding: 0.5rem 1rem;
    background: transparent;
    color: #3B82F6;
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 6px;
    font-size: 0.813rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
}

.view-calendar-btn:hover {
    background: rgba(59, 130, 246, 0.1);
    border-color: #3B82F6;
}

.calendar-events {
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
}

.calendar-event {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: 10px;
    border-left: 3px solid #3B82F6;
    transition: all 0.2s ease;
}

html.dark .calendar-event {
    background: var(--bg-tertiary);
}

.calendar-event:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow-md);
}

.event-date {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.625rem;
    background: var(--bg-primary);
    border-radius: 8px;
    min-width: 55px;
    border: 1px solid var(--border-primary);
}

html.dark .event-date {
    background: var(--bg-secondary);
}

.event-day {
    font-size: 1.375rem;
    font-weight: 700;
    color: #3B82F6;
    line-height: 1;
}

.event-month {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
}

.event-details {
    flex: 1;
}

.event-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.event-platform {
    font-size: 0.813rem;
    color: var(--text-tertiary);
}

.event-status {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.status-draft { 
    background: rgba(107, 114, 128, 0.1);
    color: #6B7280;
}
.status-in-progress { 
    background: rgba(251, 191, 36, 0.1);
    color: #F59E0B;
}
.status-ready { 
    background: rgba(16, 185, 129, 0.1);
    color: #10B981;
}

.empty-calendar {
    text-align: center;
    padding: 3rem 2rem;
    background: transparent;
    border-radius: 12px;
    border: 2px dashed var(--border-primary);
}

.empty-calendar > i {
    font-size: 3rem;
    color: var(--text-tertiary);
    margin-bottom: 1rem;
}

.empty-calendar h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.empty-calendar p {
    font-size: 0.875rem;
    color: var(--text-tertiary);
    margin-bottom: 1.5rem;
}

.empty-calendar .plan-content-btn {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.empty-calendar .plan-content-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

/* X Suggestions */
.suggestions-list {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
    margin-top: 1rem;
}

.suggestion-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    transition: all 0.2s ease;
    cursor: pointer;
}

html.dark .suggestion-card {
    background: var(--bg-secondary);
}

.suggestion-card:hover {
    border-color: rgba(59, 130, 246, 0.3);
    box-shadow: var(--shadow-md);
}

.suggestion-collapsed {
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.suggestion-title-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex: 1;
    min-width: 0;
}

.suggestion-number {
    width: 26px;
    height: 26px;
    border-radius: 6px;
    background: rgba(59, 130, 246, 0.1);
    color: #3B82F6;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.813rem;
    font-weight: 600;
    flex-shrink: 0;
}

.suggestion-title {
    font-size: 0.938rem;
    font-weight: 500;
    color: var(--text-primary);
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.hook-badge {
    padding: 0.25rem 0.5rem;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 6px;
    font-size: 0.688rem;
    font-weight: 500;
    color: #3B82F6;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    flex-shrink: 0;
}

.expand-icon {
    color: var(--text-tertiary);
    font-size: 1.125rem;
    transition: transform 0.2s ease;
    flex-shrink: 0;
}

.suggestion-card.expanded .expand-icon {
    transform: rotate(180deg);
}

.suggestion-expanded {
    padding: 0 1rem 1rem 1rem;
    display: none;
    border-top: 1px solid var(--border-primary);
    margin-top: 0.875rem;
    padding-top: 1rem;
}

.suggestion-card.expanded .suggestion-expanded {
    display: block;
}

.suggestion-content {
    background: transparent;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
    line-height: 1.5;
    color: var(--text-primary);
    white-space: pre-wrap;
    border-left: 3px solid rgba(59, 130, 246, 0.3);
}

.suggestion-actions {
    display: flex;
    gap: 0.5rem;
}

.suggestion-btn {
    flex: 1;
    padding: 0.625rem 1rem;
    border-radius: 6px;
    font-size: 0.813rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    text-decoration: none;
}

.btn-use {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    border: none;
}

.btn-use:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-copy {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-primary);
}

.btn-copy:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border-color: rgba(59, 130, 246, 0.3);
}

.suggestions-loading,
.suggestions-empty {
    text-align: center;
    padding: 3rem 2rem;
    background: transparent;
    border-radius: 12px;
    border: 2px dashed var(--border-primary);
}

.suggestions-error {
    text-align: center;
    padding: 2rem;
    background: rgba(239, 68, 68, 0.05);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 8px;
    color: #EF4444;
}

/* Guest Hero */
.guest-hero {
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.08) 0%, 
        rgba(37, 99, 235, 0.08) 100%);
    padding: 4rem 2rem;
    border-radius: 24px;
    margin-bottom: 3rem;
    text-align: center;
    border: 1px solid rgba(59, 130, 246, 0.12);
}

html.dark .guest-hero {
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.1) 0%, 
        rgba(37, 99, 235, 0.1) 100%);
    border-color: rgba(59, 130, 246, 0.2);
}

.guest-hero h1 {
    font-size: 3.5rem;
    font-weight: 900;
    color: var(--text-primary);
    margin-bottom: 1rem;
    line-height: 1.1;
    letter-spacing: -0.02em;
}

.gradient-text {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.guest-hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    margin-bottom: 2.5rem;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
}

.hero-cta {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.hero-btn {
    padding: 1rem 2rem;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.hero-btn-primary {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.hero-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

.hero-btn-secondary {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border: 2px solid var(--border-primary);
}

.hero-btn-secondary:hover {
    background: var(--bg-tertiary);
}

/* Features Preview */
.features-preview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.preview-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 16px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
}

html.dark .preview-card {
    background: var(--bg-secondary);
}

.preview-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: rgba(59, 130, 246, 0.2);
}

.preview-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 1rem;
    background: rgba(59, 130, 246, 0.1);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    color: #3B82F6;
}

.preview-card h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
}

.preview-card p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.preview-features {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    text-align: left;
    margin-top: 1rem;
    min-height: 180px;
}

.preview-feature {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.813rem;
    color: var(--text-secondary);
}

.preview-feature i {
    color: #10B981;
    font-size: 0.875rem;
    flex-shrink: 0;
}

/* Loading states */
.skeleton-loader {
    background: linear-gradient(90deg, 
        var(--bg-tertiary) 25%, 
        var(--bg-secondary) 50%, 
        var(--bg-tertiary) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 6px;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 1024px) {
    .channels-grid {
        grid-template-columns: 1fr;
    }
    
    .carousel-container {
        padding: 0 1.5rem;
    }
}

@media (max-width: 768px) {
    .dashboard-container {
        padding: 1rem;
    }
    
    .dashboard-header {
        flex-direction: column;
        gap: 1.5rem;
        text-align: center;
        min-height: auto;
        padding: 1.5rem;
    }
    
    .welcome-title {
        font-size: 1.75rem;
    }
    
    .header-stats {
        width: 100%;
        justify-content: space-around;
    }
    
    .channels-grid {
        gap: 1rem;
    }
    
    .channel-metrics {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .guest-hero h1 {
        font-size: 2.5rem;
    }
    
    .guest-hero p {
        font-size: 1.125rem;
    }
    
    .features-preview {
        grid-template-columns: 1fr;
    }
    
    .carousel-container {
        padding: 0 1rem;
    }
    
    .action-card {
        width: 200px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-container">
        {% if g.user and not g.user.get('is_guest') %}
        <!-- Logged in user dashboard -->
        
        <!-- Header with Welcome and Stats -->
        <div class="dashboard-header">
            <div class="welcome-content">
                <h1 class="welcome-title">Welcome back, <span id="username-display">{{ g.user.get('data', {}).get('username', 'Creator') }}</span></h1>
            </div>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="stat-value" id="credits-display">
                        <div class="skeleton-loader" style="width: 60px; height: 24px;"></div>
                    </div>
                    <div class="stat-label">Credits</div>
                </div>
                <div class="header-stat">
                    <div class="stat-value" id="streak-display">
                        <div class="skeleton-loader" style="width: 40px; height: 24px;"></div>
                    </div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Carousel Section -->
        <div class="quick-actions-section" id="quick-actions-section" style="display: none;">
            <div class="quick-actions-header">
                <h2 class="quick-actions-title">What would you like to do today?</h2>
                <p class="quick-actions-subtitle">Your personalized toolkit based on connected accounts</p>
            </div>

            <div class="carousel-container">
                <div class="carousel-wrapper">
                    <div class="carousel-track auto-scrolling" id="carousel-track">
                        <!-- Action cards will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="calendar-section" id="analytics-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-chart-line"></i> Analytics</h2>
            </div>

            <!-- Connected Channels Grid -->
            <div class="channels-grid" id="channels-container">
                <!-- YouTube Channel Card -->
                <div class="channel-card" id="youtube-card" style="display: none;">
                    <div class="channel-header">
                        <div class="channel-info">
                            <div class="channel-icon youtube">
                                <i class="ph ph-youtube-logo"></i>
                            </div>
                            <div class="channel-name">
                                <h3>YouTube</h3>
                                <div class="channel-username" id="youtube-username">Loading...</div>
                            </div>
                        </div>
                        <a href="{{ url_for('analytics.index', platform='youtube') }}" class="view-analytics-btn">
                            <i class="ph ph-chart-line"></i>
                            Analytics
                        </a>
                    </div>
                    
                    <div class="channel-metrics" id="youtube-metrics">
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Views</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Subscribers</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Watch Time</div>
                        </div>
                    </div>
                </div>

                <!-- X Channel Card -->
                <div class="channel-card" id="x-card" style="display: none;">
                    <div class="channel-header">
                        <div class="channel-info">
                            <div class="channel-icon x">
                                <i class="ph ph-x-logo"></i>
                            </div>
                            <div class="channel-name">
                                <h3>X</h3>
                                <div class="channel-username" id="x-username">Loading...</div>
                            </div>
                        </div>
                        <a href="{{ url_for('analytics.index', platform='x') }}" class="view-analytics-btn">
                            <i class="ph ph-chart-line"></i>
                            Analytics
                        </a>
                    </div>
                    
                    <div class="channel-metrics" id="x-metrics">
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Followers</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Avg Views</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Engagement</div>
                        </div>
                    </div>
                </div>

                <!-- TikTok Channel Card -->
                <div class="channel-card" id="tiktok-card" style="display: none;">
                    <div class="channel-header">
                        <div class="channel-info">
                            <div class="channel-icon tiktok">
                                <i class="ph ph-tiktok-logo"></i>
                            </div>
                            <div class="channel-name">
                                <h3>TikTok</h3>
                                <div class="channel-username" id="tiktok-username">Loading...</div>
                            </div>
                        </div>
                        <a href="{{ url_for('analytics.index', platform='tiktok') }}" class="view-analytics-btn">
                            <i class="ph ph-chart-line"></i>
                            Analytics
                        </a>
                    </div>
                    
                    <div class="channel-metrics" id="tiktok-metrics">
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Followers</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Total Likes</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                            <div class="metric-label">Engagement</div>
                        </div>
                    </div>
                </div>

                <!-- Connect Channel Cards -->
                <div class="channel-card connect-channel-card" id="connect-youtube" style="display: none;">
                    <div class="connect-content">
                        <i class="ph ph-youtube-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                        <h3>Connect YouTube</h3>
                        <p>Track your channel analytics and optimize your content strategy</p>
                        <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                            <i class="ph ph-link"></i>
                            Connect Channel
                        </a>
                    </div>
                </div>

                <div class="channel-card connect-channel-card" id="connect-x" style="display: none;">
                    <div class="connect-content">
                        <i class="ph ph-x-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                        <h3>Connect X</h3>
                        <p>Monitor your engagement and discover trending topics</p>
                        <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                            <i class="ph ph-link"></i>
                            Connect Account
                        </a>
                    </div>
                </div>

                <div class="channel-card connect-channel-card" id="connect-tiktok" style="display: none;">
                    <div class="connect-content">
                        <i class="ph ph-tiktok-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                        <h3>Connect TikTok</h3>
                        <p>Track your viral potential and trending content</p>
                        <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                            <i class="ph ph-link"></i>
                            Connect Account
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- X Post Suggestions Section -->
        <div class="calendar-section" id="x-suggestions-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-lightbulb"></i> Daily Post Suggestions</h2>
                <button id="refresh-suggestions-btn" class="view-calendar-btn" onclick="loadXSuggestions(true)">
                    <i class="ph ph-arrows-clockwise"></i>
                    Refresh Ideas
                </button>
            </div>

            <div id="x-suggestions-container">
                <!-- Suggestions will be loaded here -->
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="calendar-section" id="calendar-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-calendar"></i> Upcoming Content</h2>
                <a href="{{ url_for('content_calendar.content_calendar') }}" class="view-calendar-btn">
                    View Full Calendar
                </a>
            </div>
            
            <div class="calendar-events" id="calendar-events">
                <!-- Calendar events will be loaded here -->
            </div>
        </div>

        {% else %}
        <!-- Guest user dashboard -->
        <div class="guest-hero">
            <h1>Create Content That <span class="gradient-text">Goes Viral</span></h1>
            <p>AI-powered tools to help you create engaging content, analyze performance, and grow your audience across YouTube, X, and TikTok</p>
            <div class="hero-cta">
                <a href="/auth/register" class="hero-btn hero-btn-primary">
                    <i class="ph ph-rocket-launch"></i>
                    Start Creating Free
                </a>
                <a href="/auth/login" class="hero-btn hero-btn-secondary">
                    <i class="ph ph-sign-in"></i>
                    Sign In
                </a>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="features-preview">
            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-youtube-logo"></i>
                </div>
                <h3>YouTube Suite</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>AI Script Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Thumbnail Creator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Title & Tags Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Description Optimizer</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Competitor Analysis</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Performance Analytics</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-x-logo"></i>
                </div>
                <h3>X Toolkit</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Thread & Post Editor</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Reply Guy Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Spaces Clipper</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Niche Radar</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Engagement Analytics</span>
                    </div>
                    <div class="preview-feature" style="visibility: hidden;">
                        <i class="ph ph-check-circle"></i>
                        <span>&nbsp;</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-tiktok-logo"></i>
                </div>
                <h3>TikTok Tools</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Hook Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Titles & Hashtags</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Trending Sounds Finder</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Trend Tracker</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Performance Analytics</span>
                    </div>
                    <div class="preview-feature" style="visibility: hidden;">
                        <i class="ph ph-check-circle"></i>
                        <span>&nbsp;</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-folder-open"></i>
                </div>
                <h3>Content Management</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Brain Dump - Capture Ideas</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Mind Map - Visualize Concepts</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Content Wiki - Knowledge Base</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Content Calendar - Plan & Schedule</span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Define all available features per platform
const platformFeatures = {
    youtube: [
        { icon: 'ph-scroll', title: 'Create Script', desc: 'AI-powered scripts', url: '{{ url_for("video_script.video_script") }}' },
        { icon: 'ph-sparkle', title: 'Title & Tags', desc: 'Viral titles + SEO tags', url: '{{ url_for("video_title_tags.video_title_tags") }}' },
        { icon: 'ph-file-text', title: 'Write Description', desc: 'Engaging descriptions', url: '{{ url_for("video_description.video_description") }}' },
        { icon: 'ph-image', title: 'Design Thumbnail', desc: 'Eye-catching thumbnails', url: '{{ url_for("thumbnail.index") }}' },
        { icon: 'ph-video', title: 'Analyze Video', desc: 'Performance insights', url: '{{ url_for("analyze_video.analyze_video") }}' },
        { icon: 'ph-users-three', title: 'Track Competitors', desc: 'Monitor competition', url: '{{ url_for("competitors.competitors") }}' },
        { icon: 'ph-chart-line-up', title: 'Growth Analytics', desc: 'Track your progress', url: '{{ url_for("analytics.index", platform="youtube") }}' }
    ],
    x: [
        { icon: 'ph-pencil-simple', title: 'Write Posts', desc: 'Create viral threads', url: '{{ url_for("x_post_editor.x_post_editor") }}' },
        { icon: 'ph-chat-circle-text', title: 'Generate Replies', desc: 'Smart reply suggestions', url: '{{ url_for("reply_guy.index") }}' },
        { icon: 'ph-scissors', title: 'Clip Spaces', desc: 'Extract key moments', url: '{{ url_for("clip_spaces.index") }}' },
        { icon: 'ph-compass', title: 'Find Trends', desc: 'Discover hot topics', url: '{{ url_for("niche.index") }}' },
        { icon: 'ph-chart-line-up', title: 'Track Performance', desc: 'Monitor engagement', url: '{{ url_for("analytics.index", platform="x") }}' }
    ],
    tiktok: [
        { icon: 'ph-megaphone-simple', title: 'Create Hooks', desc: 'Viral opening lines', url: '{{ url_for("hook_generator.hook_generator") }}' },
        { icon: 'ph-hash', title: 'Generate Hashtags', desc: 'Trending hashtags', url: '{{ url_for("titles_hashtags.titles_hashtags") }}' },
        { icon: 'ph-music-notes', title: 'Find Sounds', desc: 'Popular audio tracks', url: '{{ url_for("trending_sounds.trending_sounds") }}' },
        { icon: 'ph-trend-up', title: 'Discover Trends', desc: 'Viral content ideas', url: '{{ url_for("trend_finder.trend_finder") }}' },
        { icon: 'ph-chart-line-up', title: 'View Analytics', desc: 'Track performance', url: '{{ url_for("analytics.index", platform="tiktok") }}' }
    ],
    general: [
        { icon: 'ph-brain', title: 'Brain Dump', desc: 'Capture all ideas', url: '{{ url_for("brain_dump.brain_dump") }}' },
        { icon: 'ph-git-branch', title: 'Mind Map', desc: 'Visualize concepts', url: '{{ url_for("mind_map.mind_map") }}' },
        { icon: 'ph-book-open', title: 'Content Wiki', desc: 'Knowledge base', url: '{{ url_for("content_wiki.content_wiki") }}' },
        { icon: 'ph-calendar-check', title: 'Content Calendar', desc: 'Plan & schedule', url: '{{ url_for("content_calendar.content_calendar") }}' }
    ]
};

// Format numbers for display
function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toLocaleString();
}

// Format watch time hours
function formatWatchTime(minutes) {
    const hours = Math.floor(minutes / 60);
    if (hours >= 1000) return (hours / 1000).toFixed(1) + 'K hrs';
    return hours + ' hrs';
}

// Carousel functionality
function startAutoScroll() {
    const track = document.getElementById('carousel-track');
    if (!track) return;

    // Clone items for seamless infinite scroll
    const items = Array.from(track.children);

    // Duplicate the items once (creates seamless loop)
    items.forEach(item => {
        const clone = item.cloneNode(true);
        track.appendChild(clone);
    });

    track.classList.add('auto-scrolling');
}

function stopAutoScroll() {
    const track = document.getElementById('carousel-track');
    if (track) {
        track.classList.remove('auto-scrolling');
    }
}

function loadQuickActions(connectedPlatforms) {
    const track = document.getElementById('carousel-track');
    if (!track) return;

    let allFeatures = [];

    // Add features for connected platforms
    if (connectedPlatforms.youtube) {
        allFeatures.push(...platformFeatures.youtube.map(f => ({...f, platform: 'youtube'})));
    }
    if (connectedPlatforms.x) {
        allFeatures.push(...platformFeatures.x.map(f => ({...f, platform: 'x'})));
    }
    if (connectedPlatforms.tiktok) {
        allFeatures.push(...platformFeatures.tiktok.map(f => ({...f, platform: 'tiktok'})));
    }

    // Always add general features
    allFeatures.push(...platformFeatures.general.map(f => ({...f, platform: 'general'})));

    // Shuffle array to randomize card order
    for (let i = allFeatures.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allFeatures[i], allFeatures[j]] = [allFeatures[j], allFeatures[i]];
    }

    // Generate HTML for action cards
    track.innerHTML = allFeatures.map(feature => `
        <a href="${feature.url}" class="action-card">
            ${feature.platform && feature.platform !== 'general' ?
                `<div class="platform-badge ${feature.platform}">
                    <i class="ph ph-${feature.platform === 'youtube' ? 'youtube' : feature.platform === 'x' ? 'x' : 'tiktok'}-logo"></i>
                </div>` : ''
            }
            <div class="action-icon-wrapper">
                <i class="ph ${feature.icon}"></i>
            </div>
            <div class="action-card-title">${feature.title}</div>
            <div class="action-card-desc">${feature.desc}</div>
        </a>
    `).join('');

    // Start auto-scroll after a delay
    setTimeout(startAutoScroll, 2000);
}

document.addEventListener('DOMContentLoaded', async function() {
    {% if g.user and not g.user.get('is_guest') %}
    
    // Load dashboard data
    try {
        const response = await fetch('/api/dashboard-data');
        const data = await response.json();
        
        // Update username
        const usernameDisplay = document.getElementById('username-display');
        if (usernameDisplay && data.username) {
            usernameDisplay.textContent = data.username;
        }
        
        // Load credits and streak
        const statsResponse = await fetch('/api/dashboard-stats');
        const stats = await statsResponse.json();
        
        // Update credits
        const creditsDisplay = document.getElementById('credits-display');
        if (creditsDisplay) {
            creditsDisplay.textContent = stats.credits?.toLocaleString() || '0';
        }
        
        // Update streak
        const streakDisplay = document.getElementById('streak-display');
        if (streakDisplay) {
            streakDisplay.textContent = stats.login_streak || '0';
        }
        
        // Track connected platforms
        const connectedPlatforms = {
            youtube: false,
            x: false,
            tiktok: false
        };
        
        // Show/hide channel cards based on connections
        let hasConnections = false;
        
        // YouTube Card
        if (data.youtube_connected) {
            hasConnections = true;
            connectedPlatforms.youtube = true;
            document.getElementById('youtube-card').style.display = 'block';
            document.getElementById('youtube-username').textContent = '@' + data.youtube_account;
            
            // Load YouTube analytics if available
            if (data.youtube_analytics) {
                const metrics = document.getElementById('youtube-metrics');
                metrics.innerHTML = `
                    <div class="metric-item">
                        <div class="metric-value">${formatNumber(data.youtube_analytics.views || 0)}</div>
                        <div class="metric-label">Views</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">+${formatNumber(data.youtube_analytics.subscribers_gained || 0)}</div>
                        <div class="metric-label">Subscribers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatWatchTime(data.youtube_analytics.watch_time_minutes || 0)}</div>
                        <div class="metric-label">Watch Time</div>
                    </div>
                `;
            }
        } else {
            document.getElementById('connect-youtube').style.display = 'block';
        }
        
        // X Card
        if (data.x_connected) {
            hasConnections = true;
            connectedPlatforms.x = true;
            document.getElementById('x-card').style.display = 'block';
            document.getElementById('x-username').textContent = '@' + data.x_account;
            
            // Load X analytics if available
            if (data.x_analytics) {
                const metrics = document.getElementById('x-metrics');
                metrics.innerHTML = `
                    <div class="metric-item">
                        <div class="metric-value">${formatNumber(data.x_analytics.followers || 0)}</div>
                        <div class="metric-label">Followers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatNumber(data.x_analytics.avg_views || 0)}</div>
                        <div class="metric-label">Avg Views</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.x_analytics.engagement_rate_display || '0%'}</div>
                        <div class="metric-label">Engagement</div>
                    </div>
                `;
            }
        } else {
            document.getElementById('connect-x').style.display = 'block';
        }
        
        // TikTok Card
        if (data.tiktok_connected) {
            hasConnections = true;
            connectedPlatforms.tiktok = true;
            document.getElementById('tiktok-card').style.display = 'block';
            document.getElementById('tiktok-username').textContent = '@' + data.tiktok_account;

            // Load TikTok analytics if available
            if (data.tiktok_analytics) {
                const metrics = document.getElementById('tiktok-metrics');
                const tiktokData = data.tiktok_analytics;

                // Get engagement rate
                let engagementRate = tiktokData.engagement_rate || 0;

                // If engagement_rate is 0 but we have the raw data, calculate it
                if (engagementRate === 0 && tiktokData.total_views_35 > 0) {
                    const totalEngagement = (tiktokData.total_likes_35 || 0) +
                                          (tiktokData.total_comments_35 || 0) +
                                          (tiktokData.total_shares_35 || 0);
                    engagementRate = (totalEngagement / tiktokData.total_views_35) * 100;
                }

                const displayEngagement = engagementRate === 0 ? '0%' : `${engagementRate.toFixed(1)}%`;

                metrics.innerHTML = `
                    <div class="metric-item">
                        <div class="metric-value">${formatNumber(tiktokData.followers || 0)}</div>
                        <div class="metric-label">Followers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatNumber(tiktokData.likes || 0)}</div>
                        <div class="metric-label">Total Likes</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${displayEngagement}</div>
                        <div class="metric-label">Engagement</div>
                    </div>
                `;
            }
        } else {
            document.getElementById('connect-tiktok').style.display = 'block';
        }

        // Show Analytics section if at least one platform is connected
        const analyticsSection = document.getElementById('analytics-section');
        if (analyticsSection && hasConnections) {
            analyticsSection.style.display = 'block';
        }

        // Load Quick Actions based on connected platforms
        const quickActionsSection = document.getElementById('quick-actions-section');
        if (quickActionsSection) {
            quickActionsSection.style.display = 'block';
            loadQuickActions(connectedPlatforms);
        }
        
        // Always show calendar section for logged in users
        const calendarSection = document.getElementById('calendar-section');
        const eventsContainer = document.getElementById('calendar-events');

        // Show calendar section
        calendarSection.style.display = 'block';

        // Show loading state initially
        eventsContainer.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: var(--text-tertiary);">
                <i class="ph ph-circle-notch" style="font-size: 2rem; animation: spin 1s linear infinite;"></i>
                <p style="margin-top: 1rem;">Loading calendar events...</p>
            </div>
        `;

        try {
            const calendarResponse = await fetch('/content-calendar/api/events/date-range?' +
                new URLSearchParams({
                    start_date: new Date().toISOString().split('T')[0],
                    end_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    limit: 5
                })
            );

            const events = await calendarResponse.json();

            // Clear loading state
            if (events && events.length > 0) {
                // Show the events
                eventsContainer.innerHTML = events.map(event => {
                    const eventDate = new Date(event.publish_date);
                    const statusClass = `status-${event.status || 'draft'}`;
                    const statusText = event.status ? event.status.replace('-', ' ') : 'draft';

                    return `
                        <div class="calendar-event">
                            <div class="event-date">
                                <div class="event-day">${eventDate.getDate()}</div>
                                <div class="event-month">${eventDate.toLocaleDateString('en', { month: 'short' })}</div>
                            </div>
                            <div class="event-details">
                                <div class="event-title">${event.title}</div>
                                <div class="event-platform">${event.platform || 'Not specified'}</div>
                            </div>
                            <div class="event-status ${statusClass}">${statusText}</div>
                        </div>
                    `;
                }).join('');
            } else {
                // Show the empty state with call-to-action when no events
                eventsContainer.innerHTML = `
                    <div class="empty-calendar">
                        <i class="ph ph-calendar-plus"></i>
                        <h4>Start Planning Your Content</h4>
                        <p>Schedule your posts, track deadlines, and never miss an upload again</p>
                        <a href="/content-calendar" class="plan-content-btn">
                            <i class="ph ph-plus"></i>
                            Plan Content
                        </a>
                    </div>
                `;
            }
        } catch (e) {
            console.error('Error loading calendar events:', e);
            // Show empty state on error
            eventsContainer.innerHTML = `
                <div class="empty-calendar">
                    <i class="ph ph-calendar-plus"></i>
                    <h4>Start Planning Your Content</h4>
                    <p>Schedule your posts, track deadlines, and never miss an upload again</p>
                    <a href="/content-calendar" class="plan-content-btn">
                        <i class="ph ph-plus"></i>
                        Plan Content
                    </a>
                </div>
            `;
        }

        // Load X Post Suggestions if user has X connected
        if (data.x_connected) {
            loadXSuggestions();
        }

    } catch (error) {
        console.error('Error loading dashboard data:', error);
    }

    {% endif %}
});

// Load X Post Suggestions
async function loadXSuggestions(forceRefresh = false) {
    const suggestionsSection = document.getElementById('x-suggestions-section');
    const suggestionsContainer = document.getElementById('x-suggestions-container');
    const refreshBtn = document.getElementById('refresh-suggestions-btn');

    if (!suggestionsSection || !suggestionsContainer) return;

    // Show section and loading state
    suggestionsSection.style.display = 'block';

    // Disable refresh button during load
    if (refreshBtn) {
        refreshBtn.disabled = true;
        refreshBtn.style.opacity = '0.5';
    }

    suggestionsContainer.innerHTML = `
        <div style="text-align: center; padding: 2rem; color: var(--text-tertiary);">
            <i class="ph ph-circle-notch" style="font-size: 2rem; display: block; margin: 0 auto; animation: spin 1s linear infinite;"></i>
            <p style="margin-top: 1rem;">Loading suggestions...</p>
        </div>
    `;

    try {
        const url = forceRefresh ? '/api/x-content-suggestions?refresh=true' : '/api/x-content-suggestions';
        const response = await fetch(url);
        const result = await response.json();

        if (!response.ok || !result.success) {
            throw new Error(result.error || 'Failed to load suggestions');
        }

        const suggestions = result.suggestions || [];

        if (suggestions.length === 0) {
            suggestionsContainer.innerHTML = `
                <div class="suggestions-empty">
                    <i class="ph ph-lightning-slash"></i>
                    <h4>No Suggestions Available</h4>
                    <p>We need more posts to analyze. Connect your X account and ensure you have at least 5 posts.</p>
                </div>
            `;
            return;
        }

        // Render suggestions in a compact list
        let suggestionsHtml = '<div class="suggestions-list">';

        suggestions.forEach((suggestion, index) => {
            const contentId = `suggestion-content-${index}`;
            const hookTypeDisplay = formatHookType(suggestion.hook_type);
            suggestionsHtml += `
                <div class="suggestion-card" onclick="toggleSuggestion(${index})">
                    <div class="suggestion-collapsed">
                        <div class="suggestion-title-row">
                            <div class="suggestion-number">${index + 1}</div>
                            <div class="suggestion-title">${suggestion.title}</div>
                            <div class="hook-badge">${hookTypeDisplay}</div>
                        </div>
                        <i class="ph ph-caret-down expand-icon"></i>
                    </div>

                    <div class="suggestion-expanded">
                        <div class="suggestion-content" id="${contentId}">${suggestion.content}</div>

                        <div class="suggestion-actions">
                            <button class="suggestion-btn btn-use" onclick="event.stopPropagation(); useInEditorById('${contentId}')">
                                <i class="ph ph-pencil-simple"></i>
                                Use in Editor
                            </button>
                            <button class="suggestion-btn btn-copy" onclick="event.stopPropagation(); copySuggestionById('${contentId}', this)">
                                <i class="ph ph-copy"></i>
                                Copy
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });

        suggestionsHtml += '</div>';
        suggestionsContainer.innerHTML = suggestionsHtml;

    } catch (error) {
        console.error('Error loading X suggestions:', error);
        suggestionsContainer.innerHTML = `
            <div class="suggestions-error">
                <i class="ph ph-warning-circle" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                <strong>Unable to load suggestions</strong>
                <p style="margin-top: 0.5rem; font-size: 0.875rem;">${error.message}</p>
            </div>
        `;
    } finally {
        // Re-enable refresh button
        if (refreshBtn) {
            refreshBtn.disabled = false;
            refreshBtn.style.opacity = '1';
        }
    }
}

// Toggle suggestion card expansion
function toggleSuggestion(index) {
    const cards = document.querySelectorAll('.suggestion-card');
    if (cards[index]) {
        cards[index].classList.toggle('expanded');
    }
}

// Format hook type for display
function formatHookType(hookType) {
    const formatted = {
        'question': 'Question',
        'stat': 'Stat',
        'story': 'Story',
        'hot_take': 'Hot Take',
        'thread': 'Thread'
    };
    return formatted[hookType] || hookType;
}

// Helper function to get icon for hook type
function getHookIcon(hookType) {
    const icons = {
        'question': 'ph-question',
        'stat': 'ph-chart-line-up',
        'story': 'ph-book-open',
        'hot_take': 'ph-fire',
        'thread': 'ph-list-bullets'
    };
    return icons[hookType] || 'ph-chat-circle-text';
}

// Helper function to escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML.replace(/'/g, '&#39;');
}

// Use suggestion in editor by element ID
function useInEditorById(contentId) {
    const contentElement = document.getElementById(contentId);
    if (!contentElement) {
        console.error('Content element not found:', contentId);
        return;
    }

    const content = contentElement.textContent;

    // Store in sessionStorage to pass to editor
    sessionStorage.setItem('x_post_suggestion', content);

    // Navigate to editor
    window.location.href = '{{ url_for("x_post_editor.x_post_editor") }}';
}

// Copy suggestion to clipboard by element ID
async function copySuggestionById(contentId, button) {
    try {
        const contentElement = document.getElementById(contentId);
        if (!contentElement) {
            console.error('Content element not found:', contentId);
            return;
        }

        const content = contentElement.textContent;
        await navigator.clipboard.writeText(content);

        // Update button text temporarily
        const originalHtml = button.innerHTML;
        button.innerHTML = '<i class="ph ph-check"></i> Copied!';
        button.style.background = 'rgba(16, 185, 129, 0.1)';
        button.style.color = '#10B981';
        button.style.borderColor = 'rgba(16, 185, 129, 0.3)';

        setTimeout(() => {
            button.innerHTML = originalHtml;
            button.style.background = '';
            button.style.color = '';
            button.style.borderColor = '';
        }, 2000);

    } catch (error) {
        console.error('Failed to copy:', error);
        alert('Failed to copy to clipboard');
    }
}

// Pause auto-scroll when hovering
document.addEventListener('DOMContentLoaded', function() {
    const track = document.getElementById('carousel-track');
    if (track) {
        track.addEventListener('mouseenter', () => {
            track.style.animationPlayState = 'paused';
        });

        track.addEventListener('mouseleave', () => {
            track.style.animationPlayState = 'running';
        });
    }
});
</script>
{% endblock %}