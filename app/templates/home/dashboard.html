{% extends "base.html" %}

{% block title %}Dashboard - Creatrics{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<!-- Welcome Modal for New Users - Outside dashboard wrapper for fixed positioning -->
{% if g.user and not g.user.get('is_guest') %}
<div class="welcome-modal" id="welcomeModal">
    <div class="welcome-modal-backdrop"></div>
    <div class="welcome-modal-content">
        <div class="modal-icon-area">
            <div class="icon-wrapper">
                <i class="ph ph-rocket-launch"></i>
            </div>
            <div class="pulse-ring"></div>
            <div class="pulse-ring pulse-ring-delay"></div>
        </div>

        <div class="modal-content">
            <h3 class="modal-title">Welcome to Creatrics!</h3>
            <p class="modal-description">
                Your AI-powered content creation hub.
            </p>

            <div class="info-section">
                <p class="info-text">
                    <i class="ph ph-hammer"></i>
                    We're building hard for the best experience, but we're still in alpha. Expect some bugs!
                </p>
                <p class="info-text">
                    <i class="ph ph-chat-circle-dots"></i>
                    <span>Questions or feedback? Reach out: <span class="email-text">support@creatrics.com</span></span>
                </p>
            </div>

            <button class="dismiss-button" onclick="closeWelcomeModal()">
                <span>Let's Get Started</span>
                <i class="ph ph-arrow-right"></i>
            </button>
        </div>
    </div>
</div>
{% endif %}

<div class="dashboard-wrapper">
    <div class="dashboard-container">
        {% if g.user and not g.user.get('is_guest') %}
        <!-- Logged in user dashboard -->

        <!-- Header with Welcome and Stats -->
        <div class="dashboard-header">
            <div class="welcome-content">
                <h1 class="welcome-title">Welcome back, <span id="username-display">{{ g.user.get('data', {}).get('username', 'Creator') }}</span></h1>
            </div>
            <div class="header-stats">
                <a href="{{ url_for('credits_history.index') }}" class="header-stat" style="text-decoration: none; cursor: pointer; transition: transform 0.2s ease;">
                    <div class="stat-value" id="credits-display">
                        <div class="skeleton-loader" style="width: 60px; height: 24px;"></div>
                    </div>
                    <div class="stat-label">Credits</div>
                </a>
                <div class="header-stat">
                    <div class="stat-value" id="streak-display">
                        <div class="skeleton-loader" style="width: 40px; height: 24px;"></div>
                    </div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>


        <!-- Analytics Section -->
        <div class="calendar-section" id="analytics-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-chart-line"></i> Analytics</h2>
            </div>

            <!-- Connected Channels Grid -->
            <div class="channels-grid" id="channels-container">
            <!-- YouTube Channel Card -->
            <div class="channel-card" id="youtube-card" style="display: none;">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-icon youtube" style="background: transparent !important;">
                            <img src="{{ url_for('static', filename='img/templates/yt_icon_red_digital.png') }}" alt="YouTube" style="width: 48px; height: 48px;">
                        </div>
                        <div class="channel-name">
                            <h3>YouTube</h3>
                            <div class="channel-username" id="youtube-username">Loading...</div>
                        </div>
                    </div>
                    <a href="{{ url_for('analytics.index', platform='youtube') }}" class="view-analytics-btn">
                        <i class="ph ph-chart-line"></i>
                        Analytics
                    </a>
                </div>
                
                <div class="channel-metrics" id="youtube-metrics">
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Views</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Subscribers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Watch Time</div>
                    </div>
                </div>
            </div>

            <!-- X Channel Card -->
            <div class="channel-card" id="x-card" style="display: none;">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-icon x">
                            <i class="ph ph-x-logo"></i>
                        </div>
                        <div class="channel-name">
                            <h3>X</h3>
                            <div class="channel-username" id="x-username">Loading...</div>
                        </div>
                    </div>
                    <a href="{{ url_for('analytics.index', platform='x') }}" class="view-analytics-btn">
                        <i class="ph ph-chart-line"></i>
                        Analytics
                    </a>
                </div>
                
                <div class="channel-metrics" id="x-metrics">
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Followers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Avg Views</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Engagement</div>
                    </div>
                </div>
            </div>

            <!-- TikTok Channel Card -->
            <div class="channel-card" id="tiktok-card" style="display: none;">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-icon tiktok">
                            <i class="ph ph-tiktok-logo"></i>
                        </div>
                        <div class="channel-name">
                            <h3>TikTok</h3>
                            <div class="channel-username" id="tiktok-username">Loading...</div>
                        </div>
                    </div>
                    <a href="{{ url_for('analytics.index', platform='tiktok') }}" class="view-analytics-btn">
                        <i class="ph ph-chart-line"></i>
                        Analytics
                    </a>
                </div>
                
                <div class="channel-metrics" id="tiktok-metrics">
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Followers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Total Likes</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Engagement</div>
                    </div>
                </div>
            </div>

            <!-- Connect Channel Cards -->
            <div class="channel-card connect-channel-card" id="connect-youtube" style="display: none;">
                <div class="connect-content">
                    <img src="{{ url_for('static', filename='img/templates/yt_icon_red_digital.png') }}" alt="YouTube" style="width: 56px; height: 56px; margin-bottom: 1rem;">
                    <h3>Connect YouTube</h3>
                    <p>Track your channel analytics and optimize your content strategy</p>
                    <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                        <i class="ph ph-link"></i>
                        Connect Channel
                    </a>
                </div>
            </div>

            <div class="channel-card connect-channel-card" id="connect-x" style="display: none;">
                <div class="connect-content">
                    <i class="ph ph-x-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                    <h3>Connect X</h3>
                    <p>Monitor your engagement and discover trending topics</p>
                    <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                        <i class="ph ph-link"></i>
                        Connect Account
                    </a>
                </div>
            </div>

            <div class="channel-card connect-channel-card" id="connect-tiktok" style="display: none;">
                <div class="connect-content">
                    <i class="ph ph-tiktok-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                    <h3>Connect TikTok</h3>
                    <p>Track your viral potential and trending content</p>
                    <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                        <i class="ph ph-link"></i>
                        Connect Account
                    </a>
                </div>
            </div>
            </div>
        </div>

        <!-- Optimize Videos Section -->
        <div class="calendar-section" id="optimize-videos-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-magic-wand"></i> Manage & Optimize Videos</h2>
                <a href="{{ url_for('optimize_video.optimize_video') }}" class="view-calendar-btn">
                    View All Videos
                </a>
            </div>

            <div id="optimize-videos-container">
                <!-- Unoptimized videos will be loaded here -->
            </div>
        </div>

        <!-- X Post Suggestions Section -->
        <div class="calendar-section" id="x-suggestions-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-lightbulb"></i> Daily Post Suggestions</h2>
                <button id="refresh-suggestions-btn" class="view-analytics-btn" onclick="loadXSuggestions(true)">
                    Refresh Ideas
                </button>
            </div>

            <div id="x-suggestions-container">
                <!-- Suggestions will be loaded here -->
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="calendar-section" id="calendar-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-calendar"></i> Upcoming Content</h2>
                <a href="{{ url_for('content_calendar.content_calendar') }}" class="view-analytics-btn">
                    View Content Calendar
                </a>
            </div>
            
            <div class="calendar-events" id="calendar-events">
                <!-- Calendar events will be loaded here -->
            </div>
        </div>

        {% else %}
        <!-- Guest user dashboard -->
        <div class="guest-hero">
            <h1>Create Content That <span class="gradient-text">Goes Viral</span></h1>
            <p>AI-powered tools to help you create engaging content, analyze performance, and grow your audience across YouTube, X, and TikTok</p>
            <div class="hero-cta">
                <a href="/auth/register" class="hero-btn hero-btn-primary">
                    <i class="ph ph-rocket-launch"></i>
                    Start Creating Free
                </a>
                <a href="/auth/login" class="hero-btn hero-btn-secondary">
                    <i class="ph ph-sign-in"></i>
                    Sign In
                </a>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="features-preview">
            <div class="preview-card">
                <div class="preview-icon">
                    <img src="{{ url_for('static', filename='img/templates/yt_icon_red_digital.png') }}" alt="YouTube" style="width: 56px; height: 56px;">
                </div>
                <h3>YouTube Tools</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Keyword Research</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Analyze Video</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Competitors</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Video Script</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Title & More</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Manage & Optimize</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Thumbnail</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Analytics</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-tiktok-logo"></i>
                </div>
                <h3>TikTok Tools</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Trend Finder</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Keyword Research</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Competitors</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Hook Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Upload Studio</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Analytics</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-x-logo"></i>
                </div>
                <h3>X Tools</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Post Studio</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Reply Guy</span>
                    </div>
                    <div class="preview-feature" style="display: none;">
                        <i class="ph ph-check-circle"></i>
                        <span>Clip Spaces</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Niche Radar</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>News Tracker</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Analytics</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-folder-open"></i>
                </div>
                <h3>Content Hub</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Brain Dump</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Mind Map</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Content Wiki</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Content Calendar</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mission & Vision Section -->
        <div class="mission-vision-section">
            <div class="mission-vision-content">
                <div class="mission-vision-icon">
                    <i class="ph ph-rocket-launch"></i>
                </div>
                <h2>Our Mission & Vision</h2>
                <div class="mission-vision-cards">
                    <div class="mission-card">
                        <div class="card-icon">
                            <i class="ph ph-target"></i>
                        </div>
                        <h3>Our Mission</h3>
                        <p>We're building an AI-powered platform that helps creators automate tasks and simplify their workflow. We've consolidated the best features from different tools into one comprehensive app—and added even more.</p>
                    </div>
                    <div class="mission-card">
                        <div class="card-icon">
                            <i class="ph ph-heart"></i>
                        </div>
                        <h3>Our Belief</h3>
                        <p>We believe AI is an amazing tool to enhance the creative process, but AI-generated content alone lacks soul. That's why we focus on empowering creators—not replacing them.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Social Links - Minimal -->
        <div class="social-section">
            <p class="social-heading">Follow us on</p>
            <div class="social-links">
                <a href="https://x.com/creatrics_" target="_blank" rel="noopener noreferrer" class="social-link">
                    <i class="ph-fill ph-x-logo"></i>
                </a>
                <a href="https://www.youtube.com/@Creatrics" target="_blank" rel="noopener noreferrer" class="social-link">
                    <img src="{{ url_for('static', filename='img/templates/yt_icon_red_digital.png') }}" alt="YouTube" style="width: 42px; height: 42px;">
                </a>
            </div>
        </div>

        <!-- Footer - Clean -->
        <footer class="home-footer">
            <p>&copy; 2025 Creatrics. All rights reserved.</p>
        </footer>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Move modal to body level IMMEDIATELY to prevent shifting
(function() {
    const modal = document.getElementById('welcomeModal');
    const container = document.getElementById('welcomeModalContainer');
    if (modal && container) {
        container.appendChild(modal);
    }
})();
</script>
<script src="{{ url_for('static', filename='scripts/dashboard.js') }}"></script>
{% endblock %}