{% extends "base.html" %}

{% block title %}Dashboard - Creatrics{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-container">
        {% if g.user and not g.user.get('is_guest') %}
        <!-- Logged in user dashboard -->

        <!-- Welcome Modal for New Users -->
        <div class="welcome-modal" id="welcomeModal" style="display: none;">
            <div class="welcome-modal-backdrop"></div>
            <div class="welcome-modal-content">
                <div class="welcome-modal-header">
                    <div class="welcome-icon">
                        <i class="ph ph-rocket-launch"></i>
                    </div>
                    <h2>Welcome to Creatrics!</h2>
                    <p class="welcome-subtitle">Your AI-Powered Content Creation Hub</p>
                </div>

                <div class="welcome-modal-body">
                    <div class="welcome-message">
                        <p>We're excited to have you here! Creatrics helps you create viral content across YouTube, X, and TikTok with powerful AI tools.</p>
                    </div>

                    <div class="welcome-steps">
                        <div class="welcome-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Connect Your Accounts</h4>
                                <p>Link your social media accounts to unlock analytics and personalized insights</p>
                            </div>
                        </div>
                        <div class="welcome-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Explore AI Tools</h4>
                                <p>Use our suite of AI-powered tools to create titles, scripts, thumbnails, and more</p>
                            </div>
                        </div>
                        <div class="welcome-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Track Your Growth</h4>
                                <p>Monitor your performance and optimize your content strategy with detailed analytics</p>
                            </div>
                        </div>
                    </div>

                    <div class="alpha-notice">
                        <i class="ph ph-warning-circle"></i>
                        <div>
                            <strong>Alpha Version Notice</strong>
                            <p>Creatrics is currently in alpha. You may encounter bugs or incomplete features. We appreciate your patience and feedback!</p>
                        </div>
                    </div>

                    <div class="support-info">
                        <i class="ph ph-envelope"></i>
                        <div>
                            <strong>Need Help?</strong>
                            <p>Connect with us at <a href="mailto:support@creatrics.com">support@creatrics.com</a></p>
                        </div>
                    </div>
                </div>

                <div class="welcome-modal-footer">
                    <button class="welcome-close-btn" onclick="closeWelcomeModal()">
                        <span>Get Started</span>
                        <i class="ph ph-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Header with Welcome and Stats -->
        <div class="dashboard-header">
            <div class="welcome-content">
                <h1 class="welcome-title">Welcome back, <span id="username-display">{{ g.user.get('data', {}).get('username', 'Creator') }}</span></h1>
            </div>
            <div class="header-stats">
                <a href="{{ url_for('credits_history.index') }}" class="header-stat" style="text-decoration: none; cursor: pointer; transition: transform 0.2s ease;">
                    <div class="stat-value" id="credits-display">
                        <div class="skeleton-loader" style="width: 60px; height: 24px;"></div>
                    </div>
                    <div class="stat-label">Credits</div>
                </a>
                <div class="header-stat">
                    <div class="stat-value" id="streak-display">
                        <div class="skeleton-loader" style="width: 40px; height: 24px;"></div>
                    </div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>


        <!-- Analytics Section -->
        <div class="calendar-section" id="analytics-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-chart-line"></i> Analytics</h2>
            </div>

            <!-- Connected Channels Grid -->
            <div class="channels-grid" id="channels-container">
            <!-- YouTube Channel Card -->
            <div class="channel-card" id="youtube-card" style="display: none;">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-icon youtube">
                            <i class="ph ph-youtube-logo"></i>
                        </div>
                        <div class="channel-name">
                            <h3>YouTube</h3>
                            <div class="channel-username" id="youtube-username">Loading...</div>
                        </div>
                    </div>
                    <a href="{{ url_for('analytics.index', platform='youtube') }}" class="view-analytics-btn">
                        <i class="ph ph-chart-line"></i>
                        Analytics
                    </a>
                </div>
                
                <div class="channel-metrics" id="youtube-metrics">
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Views</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Subscribers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Watch Time</div>
                    </div>
                </div>
            </div>

            <!-- X Channel Card -->
            <div class="channel-card" id="x-card" style="display: none;">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-icon x">
                            <i class="ph ph-x-logo"></i>
                        </div>
                        <div class="channel-name">
                            <h3>X</h3>
                            <div class="channel-username" id="x-username">Loading...</div>
                        </div>
                    </div>
                    <a href="{{ url_for('analytics.index', platform='x') }}" class="view-analytics-btn">
                        <i class="ph ph-chart-line"></i>
                        Analytics
                    </a>
                </div>
                
                <div class="channel-metrics" id="x-metrics">
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Followers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Avg Views</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Engagement</div>
                    </div>
                </div>
            </div>

            <!-- TikTok Channel Card -->
            <div class="channel-card" id="tiktok-card" style="display: none;">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-icon tiktok">
                            <i class="ph ph-tiktok-logo"></i>
                        </div>
                        <div class="channel-name">
                            <h3>TikTok</h3>
                            <div class="channel-username" id="tiktok-username">Loading...</div>
                        </div>
                    </div>
                    <a href="{{ url_for('analytics.index', platform='tiktok') }}" class="view-analytics-btn">
                        <i class="ph ph-chart-line"></i>
                        Analytics
                    </a>
                </div>
                
                <div class="channel-metrics" id="tiktok-metrics">
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Followers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Total Likes</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value skeleton-loader" style="width: 60px; height: 20px; margin: 0 auto;"></div>
                        <div class="metric-label">Engagement</div>
                    </div>
                </div>
            </div>

            <!-- Connect Channel Cards -->
            <div class="channel-card connect-channel-card" id="connect-youtube" style="display: none;">
                <div class="connect-content">
                    <i class="ph ph-youtube-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                    <h3>Connect YouTube</h3>
                    <p>Track your channel analytics and optimize your content strategy</p>
                    <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                        <i class="ph ph-link"></i>
                        Connect Channel
                    </a>
                </div>
            </div>

            <div class="channel-card connect-channel-card" id="connect-x" style="display: none;">
                <div class="connect-content">
                    <i class="ph ph-x-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                    <h3>Connect X</h3>
                    <p>Monitor your engagement and discover trending topics</p>
                    <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                        <i class="ph ph-link"></i>
                        Connect Account
                    </a>
                </div>
            </div>

            <div class="channel-card connect-channel-card" id="connect-tiktok" style="display: none;">
                <div class="connect-content">
                    <i class="ph ph-tiktok-logo" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: 1rem;"></i>
                    <h3>Connect TikTok</h3>
                    <p>Track your viral potential and trending content</p>
                    <a href="{{ url_for('accounts.index') }}" class="connect-btn">
                        <i class="ph ph-link"></i>
                        Connect Account
                    </a>
                </div>
            </div>
            </div>
        </div>

        <!-- Optimize Videos Section -->
        <div class="calendar-section" id="optimize-videos-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-magic-wand"></i> Optimize Videos</h2>
                <a href="{{ url_for('optimize_video.optimize_video') }}" class="view-calendar-btn">
                    View All Videos
                </a>
            </div>

            <div id="optimize-videos-container">
                <!-- Unoptimized videos will be loaded here -->
            </div>
        </div>

        <!-- X Post Suggestions Section -->
        <div class="calendar-section" id="x-suggestions-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-lightbulb"></i> Daily Post Suggestions</h2>
                <button id="refresh-suggestions-btn" class="view-calendar-btn" onclick="loadXSuggestions(true)">
                    <i class="ph ph-arrows-clockwise"></i>
                    Refresh Ideas
                </button>
            </div>

            <div id="x-suggestions-container">
                <!-- Suggestions will be loaded here -->
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="calendar-section" id="calendar-section" style="display: none;">
            <div class="calendar-header">
                <h2><i class="ph ph-calendar"></i> Upcoming Content</h2>
                <a href="{{ url_for('content_calendar.content_calendar') }}" class="view-calendar-btn">
                    View Full Calendar
                </a>
            </div>
            
            <div class="calendar-events" id="calendar-events">
                <!-- Calendar events will be loaded here -->
            </div>
        </div>

        {% else %}
        <!-- Guest user dashboard -->
        <div class="guest-hero">
            <h1>Create Content That <span class="gradient-text">Goes Viral</span></h1>
            <p>AI-powered tools to help you create engaging content, analyze performance, and grow your audience across YouTube, X, and TikTok</p>
            <div class="hero-cta">
                <a href="/auth/register" class="hero-btn hero-btn-primary">
                    <i class="ph ph-rocket-launch"></i>
                    Start Creating Free
                </a>
                <a href="/auth/login" class="hero-btn hero-btn-secondary">
                    <i class="ph ph-sign-in"></i>
                    Sign In
                </a>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="features-preview">
            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-youtube-logo"></i>
                </div>
                <h3>YouTube Suite</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>AI Script Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Thumbnail Creator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Title & Tags Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Description Optimizer</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Competitor Analysis</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Performance Analytics</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-x-logo"></i>
                </div>
                <h3>X Toolkit</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Thread & Post Editor</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Reply Guy Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Spaces Clipper</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Niche Radar</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Engagement Analytics</span>
                    </div>
                    <div class="preview-feature" style="visibility: hidden;">
                        <i class="ph ph-check-circle"></i>
                        <span>&nbsp;</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-tiktok-logo"></i>
                </div>
                <h3>TikTok Tools</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Trend Finder</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Keyword Research</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Competitors Analysis</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Hook Generator</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Titles & Hashtags</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Performance Analytics</span>
                    </div>
                </div>
            </div>

            <div class="preview-card">
                <div class="preview-icon">
                    <i class="ph ph-folder-open"></i>
                </div>
                <h3>Content Management</h3>
                <div class="preview-features">
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Brain Dump - Capture Ideas</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Mind Map - Visualize Concepts</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Content Wiki - Knowledge Base</span>
                    </div>
                    <div class="preview-feature">
                        <i class="ph ph-check-circle"></i>
                        <span>Content Calendar - Plan & Schedule</span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/dashboard.js') }}"></script>
{% endblock %}