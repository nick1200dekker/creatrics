{% extends "base.html" %}

{% block title %}Team Stats - Soccer Analytics{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="ph ph-users-three me-2"></i>
                        Team Stats
                    </h1>
                    <p class="text-muted mb-0">Analyze team performance and league standings</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary">
                        <i class="ph ph-export me-1"></i>
                        Export Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="teamSearch" class="form-label">Search Teams</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="ph ph-magnifying-glass"></i>
                                </span>
                                <input type="text" class="form-control" id="teamSearch" placeholder="Enter team name...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label for="leagueFilter" class="form-label">League</label>
                            <select class="form-select" id="leagueFilter">
                                <option value="">All Leagues</option>
                                <option value="premier-league">Premier League</option>
                                <option value="la-liga">La Liga</option>
                                <option value="bundesliga">Bundesliga</option>
                                <option value="serie-a">Serie A</option>
                                <option value="ligue-1">Ligue 1</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="countryFilter" class="form-label">Country</label>
                            <select class="form-select" id="countryFilter">
                                <option value="">All Countries</option>
                                <option value="england">England</option>
                                <option value="spain">Spain</option>
                                <option value="germany">Germany</option>
                                <option value="italy">Italy</option>
                                <option value="france">France</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="display-6 text-primary mb-2">
                        <i class="ph ph-trophy"></i>
                    </div>
                    <h5 class="card-title">League Leader</h5>
                    <p class="card-text text-muted">Manchester City</p>
                    <small class="text-success">80 Points</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="display-6 text-success mb-2">
                        <i class="ph ph-target"></i>
                    </div>
                    <h5 class="card-title">Most Goals</h5>
                    <p class="card-text text-muted">Manchester City</p>
                    <small class="text-success">78 Goals</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="display-6 text-warning mb-2">
                        <i class="ph ph-shield-check"></i>
                    </div>
                    <h5 class="card-title">Best Defense</h5>
                    <p class="card-text text-muted">Arsenal</p>
                    <small class="text-success">25 Goals Against</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="display-6 text-info mb-2">
                        <i class="ph ph-trend-up"></i>
                    </div>
                    <h5 class="card-title">Best Form</h5>
                    <p class="card-text text-muted">Newcastle</p>
                    <small class="text-success">5 Wins in 5</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Teams Table -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 py-3">
                    <h5 class="mb-0">
                        <i class="ph ph-list me-2"></i>
                        Team Statistics
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Pos</th>
                                    <th>Team</th>
                                    <th>League</th>
                                    <th>W</th>
                                    <th>D</th>
                                    <th>L</th>
                                    <th>GF</th>
                                    <th>GA</th>
                                    <th>GD</th>
                                    <th>Pts</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="teamsTableBody">
                                <tr>
                                    <td><span class="badge bg-success">1</span></td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar avatar-sm me-2">
                                                <div class="avatar-initial rounded-circle bg-primary">MC</div>
                                            </div>
                                            <div>
                                                <div class="fw-semibold">Manchester City</div>
                                                <small class="text-muted">England</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>Premier League</td>
                                    <td><strong>25</strong></td>
                                    <td>5</td>
                                    <td>3</td>
                                    <td>78</td>
                                    <td>25</td>
                                    <td class="text-success">+53</td>
                                    <td><strong>80</strong></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewTeamDetails(1)">
                                            <i class="ph ph-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success">2</span></td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar avatar-sm me-2">
                                                <div class="avatar-initial rounded-circle bg-primary">RM</div>
                                            </div>
                                            <div>
                                                <div class="fw-semibold">Real Madrid</div>
                                                <small class="text-muted">Spain</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>La Liga</td>
                                    <td><strong>28</strong></td>
                                    <td>3</td>
                                    <td>2</td>
                                    <td>85</td>
                                    <td>20</td>
                                    <td class="text-success">+65</td>
                                    <td><strong>87</strong></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewTeamDetails(2)">
                                            <i class="ph ph-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Team Details Modal -->
<div class="modal fade" id="teamDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Team Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="teamDetailsContent">
                <!-- Team details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script>
// Search functionality
document.getElementById('teamSearch').addEventListener('input', function() {
    const query = this.value;
    searchTeams(query);
});

function searchTeams(query) {
    fetch(`/team-stats/api/search?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            updateTeamsTable(data.teams);
        })
        .catch(error => {
            console.error('Error searching teams:', error);
        });
}

function updateTeamsTable(teams) {
    const tbody = document.getElementById('teamsTableBody');
    tbody.innerHTML = '';
    
    teams.forEach((team, index) => {
        const position = index + 1;
        const positionBadge = position <= 4 ? 'bg-success' : position <= 6 ? 'bg-warning' : position >= 18 ? 'bg-danger' : 'bg-secondary';
        
        const row = `
            <tr>
                <td><span class="badge ${positionBadge}">${position}</span></td>
                <td>
                    <div class="d-flex align-items-center">
                        <div class="avatar avatar-sm me-2">
                            <div class="avatar-initial rounded-circle bg-primary">${team.name.split(' ').map(n => n[0]).join('')}</div>
                        </div>
                        <div>
                            <div class="fw-semibold">${team.name}</div>
                            <small class="text-muted">${team.country}</small>
                        </div>
                    </div>
                </td>
                <td>${team.league}</td>
                <td><strong>${team.wins}</strong></td>
                <td>${team.draws}</td>
                <td>${team.losses}</td>
                <td>65</td>
                <td>30</td>
                <td class="text-success">+35</td>
                <td><strong>${team.wins * 3 + team.draws}</strong></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewTeamDetails(${team.id})">
                        <i class="ph ph-eye"></i>
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function viewTeamDetails(teamId) {
    fetch(`/team-stats/api/team/${teamId}`)
        .then(response => response.json())
        .then(data => {
            showTeamDetailsModal(data.team);
        })
        .catch(error => {
            console.error('Error fetching team details:', error);
        });
}

function showTeamDetailsModal(team) {
    const content = `
        <div class="row">
            <div class="col-md-4 text-center">
                <div class="avatar avatar-xl mb-3">
                    <div class="avatar-initial rounded-circle bg-primary fs-1">${team.name.split(' ').map(n => n[0]).join('')}</div>
                </div>
                <h4>${team.name}</h4>
                <p class="text-muted">${team.league} • ${team.country}</p>
                <p class="text-muted">Founded: ${team.founded}</p>
                <p class="text-muted">Stadium: ${team.stadium}</p>
            </div>
            <div class="col-md-8">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="text-success">${team.stats.wins}</h3>
                                <small>Wins</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="text-warning">${team.stats.draws}</h3>
                                <small>Draws</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="text-danger">${team.stats.losses}</h3>
                                <small>Losses</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="text-primary">${team.stats.points}</h3>
                                <small>Points</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="text-info">${team.stats.goals_for}</h3>
                                <small>Goals For</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="text-secondary">${team.stats.goals_against}</h3>
                                <small>Goals Against</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('teamDetailsContent').innerHTML = content;
    new bootstrap.Modal(document.getElementById('teamDetailsModal')).show();
}

// Initialize with default search
document.addEventListener('DOMContentLoaded', function() {
    searchTeams('');
});
</script>
{% endblock %}
