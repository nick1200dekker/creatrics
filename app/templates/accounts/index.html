{% extends "base.html" %}
{% set check_auth = true %}

{% block title %}Social Accounts - Creator Tools{% endblock %}

{% block head %}
{{ super() }}
<!-- Disable Turbo for this page to ensure full reload -->
<meta name="turbo-visit-control" content="reload">
<meta name="turbo-cache-control" content="no-cache">
{% endblock %}

{% block additional_styles %}
<style>
/* Reset default content-panel padding like Brain Dump */
.content-panel {
    padding: 0 !important;
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
}

/* Main Container */
.accounts-wrapper {
    background: var(--bg-secondary);
    border-radius: 12px;
    border: 1px solid var(--border-primary);
    overflow: hidden;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    width: 100%;
    max-width: 100%;
}

/* Header Section */
.accounts-header {
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border-primary);
    background: linear-gradient(135deg,
        rgba(59, 130, 246, 0.03) 0%,
        rgba(139, 92, 246, 0.03) 100%);
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

html.dark .accounts-header {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.06) 0%, rgba(139, 92, 246, 0.06) 100%);
    border-bottom-color: rgba(63, 63, 70, 0.5);
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.page-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.page-title i {
    color: #3B82F6;
}

html.dark .page-title i {
    color: #60A5FA;
}

/* Content Section */
.accounts-content {
    padding: 2rem;
    width: 100%;
    max-width: none;
}

/* Flash Messages */
.flash-message {
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
}

.flash-message.error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #EF4444;
}

html.dark .flash-message.error {
    background: rgba(239, 68, 68, 0.2);
    border-color: rgba(239, 68, 68, 0.4);
    color: #F87171;
}

.flash-message.success {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: #10B981;
}

html.dark .flash-message.success {
    background: rgba(16, 185, 129, 0.2);
    border-color: rgba(16, 185, 129, 0.4);
    color: #34D399;
}

/* Beta Warning */
.beta-warning {
    background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-left: 4px solid #F59E0B;
    color: #92400E;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    line-height: 1.6;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
}

html.dark .beta-warning {
    background: linear-gradient(135deg, rgba(254, 243, 199, 0.15) 0%, rgba(253, 230, 138, 0.15) 100%);
    border-color: rgba(245, 158, 11, 0.4);
    color: #FCD34D;
}

.beta-warning i {
    font-size: 1.25rem;
    flex-shrink: 0;
    margin-top: 0.1rem;
}

.beta-warning a {
    color: #92400E;
    text-decoration: underline;
    font-weight: 600;
}

html.dark .beta-warning a {
    color: #FCD34D;
}

.beta-warning a:hover {
    color: #78350F;
}

html.dark .beta-warning a:hover {
    color: #FDE68A;
}

/* Account Cards Grid */
.accounts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
    width: 100%;
    max-width: none;
}

/* On larger screens, use full width */
@media (min-width: 1280px) {
    .accounts-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (min-width: 768px) and (max-width: 1279px) {
    .accounts-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Account Card */
.account-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.3s ease;
}

html.dark .account-card {
    background: rgba(39, 39, 42, 0.6);
    border-color: rgba(63, 63, 70, 0.6);
    backdrop-filter: blur(10px);
}

.account-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    border-color: rgba(59, 130, 246, 0.3);
}

html.dark .account-card:hover {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    border-color: rgba(96, 165, 250, 0.4);
}

.account-card.disabled {
    opacity: 0.6;
    pointer-events: none;
    position: relative;
}

/* Card Header */
.card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.25rem;
}

.platform-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: white;
    flex-shrink: 0;
}

.platform-icon.x-platform {
    background: linear-gradient(135deg, #000000 0%, #333333 100%);
}

.platform-icon.youtube-platform {
    background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
}

.platform-icon.tiktok-platform {
    background: linear-gradient(135deg, #000000 0%, #333333 100%);
}

.platform-name {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
}

/* Connection Status */
.connection-status {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 60px;
}

.status-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.status-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.status-value {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    background: #3B82F6;
    color: white;
}

/* Form Elements */
.form-group {
    margin-bottom: 1.75rem;
}

.form-label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    font-family: 'Inter', sans-serif;
    letter-spacing: 0.02em;
}

html.dark .form-label {
    color: #d4d4d8;
}

.form-input {
    width: 100%;
    padding: 0.875rem;
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-size: 0.9rem;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    transition: all 0.2s ease;
    line-height: 1.6;
}

html.dark .form-input {
    background: rgba(63, 63, 70, 0.5);
    border-color: rgba(82, 82, 91, 0.5);
}

.form-input:focus {
    outline: none;
    border-color: #3B82F6;
    background: var(--bg-primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

html.dark .form-input:focus {
    background: rgba(39, 39, 42, 0.8);
    border-color: #60A5FA;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.15);
}

.form-input::placeholder {
    color: var(--text-tertiary);
}

.form-input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--bg-tertiary);
}

/* Buttons */
.action-button {
    width: 100%;
    padding: 0.625rem 1rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
    cursor: pointer;
    border: none;
    text-decoration: none;
}

.action-button.primary {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.action-button.primary:hover {
    background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

html.dark .action-button.primary {
    background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%);
}

html.dark .action-button.primary:hover {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
}

.action-button.secondary {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border: 1px solid var(--border-primary);
}

.action-button.secondary:hover {
    background: var(--hover-bg);
    transform: translateY(-1px);
}


/* Info Section */
.info-section {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.2s ease;
}

html.dark .info-section {
    background: rgba(39, 39, 42, 0.6);
    border-color: rgba(63, 63, 70, 0.6);
    backdrop-filter: blur(10px);
}

.info-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
}

.info-text {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.6;
}

html.dark .info-text {
    color: #d4d4d8;
}

/* Super Powers Modal */
.super-powers-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.75);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(8px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.super-powers-modal.visible {
    opacity: 1;
    pointer-events: auto;
}

.super-powers-container {
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 2rem;
    width: 90%;
    max-width: 420px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    transform: translateY(20px) scale(0.95);
    transition: transform 0.3s ease;
}

.super-powers-modal.visible .super-powers-container {
    transform: translateY(0) scale(1);
}

.modal-content {
    text-align: center;
}

.modal-progress {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.modal-time {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
}

.modal-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.loading-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid var(--border-primary);
    border-top: 2px solid #3B82F6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.modal-close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 1.25rem;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.modal-close-btn:hover {
    background: var(--hover-bg);
    color: var(--text-primary);
}

/* Responsive */
@media (max-width: 768px) {
    .accounts-header {
        padding: 1rem;
    }
    
    .accounts-content {
        padding: 1rem;
    }
    
    .accounts-grid {
        grid-template-columns: 1fr;
    }
    
    .page-title {
        font-size: 1.25rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="accounts-wrapper">
    <!-- Super Powers Modal -->
    {% if show_super_powers %}
    <div class="super-powers-modal" id="superPowersModal">
        <div class="super-powers-container">
            <button class="modal-close-btn" onclick="closeSuperPowers()">
                <i class="ph ph-x"></i>
            </button>
            <div class="modal-content">
                <p class="modal-progress">
                    {% if request.args.get('platform') == 'youtube' %}
                        YouTube Account setup in progress
                    {% elif request.args.get('platform') == 'tiktok' %}
                        TikTok Account setup in progress
                    {% else %}
                        X Account setup in progress
                    {% endif %}
                </p>
                <p class="modal-time">This will take approximately 5 minutes</p>
                <div class="modal-loading">
                    <div class="loading-spinner"></div>
                    <span>Setting up your experience...</span>
                </div>
                <button class="action-button primary" onclick="closeSuperPowers()">
                    Got it!
                </button>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Header -->
    <div class="accounts-header">
        <div class="header-content">
            <h1 class="page-title">
                <i class="ph ph-link"></i>
                Social Accounts
            </h1>
        </div>
    </div>
    
    <!-- Content -->
    <div class="accounts-content">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        <i class="ph ph-{{ 'check-circle' if category == 'success' else 'warning-circle' }}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Alpha Testing Warning for YouTube -->
        {% if not youtube_connected %}
        <div class="beta-warning">
            <i class="ph ph-warning-circle"></i>
            <div>
                <strong>Alpha Testing - Limited Access</strong><br>
                YouTube connection is currently in alpha testing. To get access, please email
                <a href="mailto:support@creatrics.com">support@creatrics.com</a> with your email address.
            </div>
        </div>
        {% endif %}

        <!-- Account Cards -->
        <div class="accounts-grid">
            <!-- YouTube Account -->
            <div class="account-card">
                <div class="card-header">
                    <div class="platform-icon youtube-platform">
                        <i class="ph ph-youtube-logo"></i>
                    </div>
                    <h2 class="platform-name">YouTube Channel</h2>
                </div>
                
                {% if youtube_connected %}
                    <div class="connection-status">
                        <div class="status-info">
                            <span class="status-label">Connected</span>
                            <span class="status-value">{{ youtube_channel }}</span>
                        </div>
                        <span class="status-badge">Active</span>
                    </div>
                    
                    <form method="POST" action="{{ url_for('accounts.disconnect_account') }}">
                        <input type="hidden" name="platform" value="youtube">
                        <button type="submit" class="action-button secondary">
                            <i class="ph ph-link-break"></i>
                            Disconnect Channel
                        </button>
                    </form>
                {% else %}
                    <div class="form-group">
                        <label for="youtube_channel" class="form-label">Channel</label>
                        <input type="text"
                               id="youtube_channel"
                               name="youtube_channel"
                               class="form-input"
                               placeholder="Press connect button"
                               disabled>
                    </div>

                    <a href="{{ url_for('accounts.youtube_connect_redirect') }}"
                       class="action-button primary"
                       data-turbo="false">
                        <i class="ph ph-link"></i>
                        Connect with YouTube
                    </a>
                {% endif %}
            </div>

            <!-- X Account -->
            <div class="account-card">
                <div class="card-header">
                    <div class="platform-icon x-platform">
                        <i class="ph ph-x-logo"></i>
                    </div>
                    <h2 class="platform-name">X Account</h2>
                </div>

                {% if x_connected %}
                    <div class="connection-status">
                        <div class="status-info">
                            <span class="status-label">Connected</span>
                            <span class="status-value">@{{ x_username }}</span>
                        </div>
                        <span class="status-badge">Active</span>
                    </div>

                    <form method="POST" action="{{ url_for('accounts.disconnect_account') }}">
                        <input type="hidden" name="platform" value="x">
                        <button type="submit" class="action-button secondary">
                            <i class="ph ph-link-break"></i>
                            Disconnect Account
                        </button>
                    </form>
                {% else %}
                    <form method="POST" action="{{ url_for('accounts.connect_account') }}">
                        <input type="hidden" name="platform" value="x">

                        <div class="form-group">
                            <label for="x_username" class="form-label">Username</label>
                            <input type="text"
                                   id="x_username"
                                   name="x_username"
                                   class="form-input"
                                   placeholder="username"
                                   required>
                        </div>

                        <button type="submit" class="action-button primary">
                            <i class="ph ph-link"></i>
                            Configure Account
                        </button>
                    </form>
                {% endif %}
            </div>

            <!-- TikTok Account -->
            <div class="account-card">
                <div class="card-header">
                    <div class="platform-icon tiktok-platform">
                        <i class="ph ph-tiktok-logo"></i>
                    </div>
                    <h2 class="platform-name">TikTok Account</h2>
                </div>
                
                {% if tiktok_connected %}
                    <div class="connection-status">
                        <div class="status-info">
                            <span class="status-label">Connected</span>
                            <span class="status-value">@{{ tiktok_username }}</span>
                        </div>
                        <span class="status-badge">Active</span>
                    </div>
                    
                    <form method="POST" action="{{ url_for('accounts.disconnect_account') }}">
                        <input type="hidden" name="platform" value="tiktok">
                        <button type="submit" class="action-button secondary">
                            <i class="ph ph-link-break"></i>
                            Disconnect Account
                        </button>
                    </form>
                {% else %}
                    <form method="POST" action="{{ url_for('accounts.connect_account') }}">
                        <input type="hidden" name="platform" value="tiktok">
                        
                        <div class="form-group">
                            <label for="tiktok_username" class="form-label">Username</label>
                            <input type="text" 
                                   id="tiktok_username" 
                                   name="tiktok_username" 
                                   class="form-input" 
                                   placeholder="username" 
                                   required>
                        </div>
                        
                        <button type="submit" class="action-button primary">
                            <i class="ph ph-link"></i>
                            Configure Account
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
        
        <!-- Info Section -->
        <div class="info-section">
            <h3 class="info-title">Why configure your accounts?</h3>
            <p class="info-text">
                Configuring your social accounts allows Creatrics to provide personalized content suggestions
                and analyze engagement metrics. For YouTube, connecting via the API gives you access to detailed
                analytics data including views, watch time, audience demographics, and more.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ensure Turbo is fully disabled for this page
    if (window.Turbo) {
        Turbo.cache.clear();
    }
    
    // Handle Super Powers modal
    const superPowersModal = document.getElementById('superPowersModal');
    
    if (superPowersModal) {
        // Show modal with animation
        setTimeout(function() {
            superPowersModal.classList.add('visible');
        }, 100);
    }
});

function closeSuperPowers() {
    const modal = document.getElementById('superPowersModal');
    if (modal) {
        modal.classList.remove('visible');
        
        // Remove modal after transition
        setTimeout(function() {
            modal.style.display = 'none';
        }, 300);
    }
}

// Disable Turbo for all links on this page to ensure clean navigation
document.addEventListener('click', function(e) {
    const link = e.target.closest('a');
    if (link && !link.hasAttribute('data-turbo')) {
        link.setAttribute('data-turbo', 'false');
    }
});
</script>
{% endblock %}